[{"content":"调整友情链接页面布局 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 ///assets/scss/custom.scss //友情链接双栏 + @media (min-width: 1024px) { + .article-list--compact.links { + display: grid; + grid-template-columns: 1fr 1fr; + background: none; + box-shadow: none; + + article { + background: var(--card-background); + border: none; + box-shadow: var(--shadow-l2); + margin-bottom: 8px; + border-radius: 10px; + \u0026amp;:nth-child(odd) { + margin-right: 8px; + } + } + } +} 代码来自Hugo | 第三篇 Stack 主题装修记录，堂堂再临！\n导航栏 隐藏某个选项 隐藏了 Home，和点击 avatar 的效果重复了\n1 2 3 4 5 .menu { li:first-child { display: none; } } 新增菜单选项 有两种办法：\n按照文档 Custom Menu 在 config.yaml 添加新菜单选项，并在 Tabler Icons 下载 icon 找到主题自带菜单选项（Home、About、Archive\u0026hellip;）所在目录，照猫画虎，举例：在 /content/page 目录下新建\u0026lt;选项名\u0026gt;文件夹，照着默认文件创建 index.md 修改背景色 在 Open Color 选个喜欢的颜色\n1 2 # assets\\scss\\variables.scss --body-background: #f5f5f5; 禁止部分页面显示 ReadingTime 比如 /friends ，不是文章，不需要显示阅读时间\n1 2 3 # /blog/layouts/partials/article/components/details.html {{ if and (not .Date.IsZero) (.Site.Params.article.readingTime) }} 默认逻辑是 if or ，改成 if and 之后只有 Front Matter 里 date 参数为 true 的页面会显示阅读时长\n暂时禁用翻译按钮 如果有对应的页面，比如 /page/about 下有：\n1 2 3 . ├── index.md └── index.zh-cn.md 就会显示翻译按钮，暂时用不到的话在 md 文件里写 draft: true即可\n支持 mermaid 按照 官方文档 新建文件 layouts/_default/_markup/render-codeblock-mermaid.html\n1 2 3 4 \u0026lt;div class=\u0026#34;mermaid\u0026#34;\u0026gt; {{- .Inner | safeHTML }} \u0026lt;/div\u0026gt; {{ .Page.Store.Set \u0026#34;hasMermaid\u0026#34; true }} 在 layouts/partials/article/components/content.html 添加：\n1 2 3 4 5 6 7 {{ .Content | replaceRE \u0026#34;(\u0026lt;table\u0026gt;(?:.|\\n)+?\u0026lt;/table\u0026gt;)\u0026#34; $wrappedTable | safeHTML }} {{ if .Page.Store.Get \u0026#34;hasMermaid\u0026#34; }} \u0026lt;script type=\u0026#34;module\u0026#34;\u0026gt; import mermaid from \u0026#39;https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs\u0026#39;; mermaid.initialize({ startOnLoad: true }); \u0026lt;/script\u0026gt; {{ end }} 演示效果：时序图/饼图/甘特图/Git图，更多请看 官方文档\nsequenceDiagram participant Alice participant Bob Alice-\u003e\u003eJohn: Hello John, how are you? loop Healthcheck John-\u003e\u003eJohn: Fight against hypochondria end Note right of John: Rational thoughts prevail! John--\u003e\u003eAlice: Great! John-\u003e\u003eBob: How about you? Bob--\u003e\u003eJohn: Jolly good! pie title Pets adopted by volunteers \"Dogs\" : 386 \"Cats\" : 85 \"Rats\" : 15 gantt title A Gantt Diagram dateFormat YYYY-MM-DD section Section A task :a1, 2014-01-01, 30d Another task :after a1 , 20d section Another Task in sec :2014-01-12 , 12d another task : 24d gitGraph commit commit branch develop checkout develop commit commit checkout main merge develop commit commit 代码块 折叠代码块 通过 details 标签实现\n1 2 3 4 5 # layouts/shortcodes/detail.html \u0026lt;details\u0026gt; \u0026lt;summary\u0026gt;{{ (.Get 0) }}\u0026lt;/summary\u0026gt; {{ .Inner | markdownify }} \u0026lt;/details\u0026gt; 生效了 (〃`𓎟´〃) 天才ですから！ 代码块 macOS 样式 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # custom.scss .highlight:before { content: \u0026#34;\u0026#34;; display: block; background: url(/code-header.svg); height: 30px; width: 100%; background-size: 45px; background-repeat: no-repeat; margin-bottom: -7px; border-radius: 5px; background-position: 10px 10px; position: absolute; top: 0; left: 0; } 修改字体 对样式不满意、就从控制台找到对应的类名，在 custom.scss 里修改就好了\n修改正文字体 参照：Example: Custom font family for article content\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 # layouts/partials/head/custom.html \u0026lt;style\u0026gt; /* Overwrite CSS variable */ :root { --article-font-family: \u0026#39;Noto Serif HK\u0026#39;, var(--base-font-family); } \u0026lt;/style\u0026gt; \u0026lt;script\u0026gt; ;(function () { const customFont = document.createElement(\u0026#39;link\u0026#39;) customFont.href = \u0026#39;https://fonts.googleapis.com/css2?family=Noto+Serif+HK:wght@300;400;500;600;700\u0026amp;display=swap\u0026#39; customFont.type = \u0026#39;text/css\u0026#39; customFont.rel = \u0026#39;stylesheet\u0026#39; document.head.appendChild(customFont) })() \u0026lt;/script\u0026gt; 修改全站字体 1 2 3 4 5 6 7 :root { --sys-font-family: \u0026#39;Noto Serif HK\u0026#39;, -apple-system, BlinkMacSystemFont, \u0026#39;Segoe UI\u0026#39;, \u0026#39;Droid Sans\u0026#39;, \u0026#39;Helvetica Neue\u0026#39;; --zh-font-family: \u0026#39;Noto Serif HK\u0026#39;, \u0026#39;Hiragino Sans GB\u0026#39;, \u0026#39;Droid Sans Fallback\u0026#39;, \u0026#39;Microsoft YaHei\u0026#39;; --base-font-family: \u0026#39;Noto Serif HK\u0026#39;, var(--sys-font-family) } 返回顶部按钮 展开代码块 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 # /layouts/partials/footer/custom.html \u0026lt;!--返回顶部按钮 --\u0026gt; \u0026lt;a href=\u0026#34;#\u0026#34; id=\u0026#34;back-to-top\u0026#34; title=\u0026#34;返回顶部\u0026#34;\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;!--返回顶部CSS --\u0026gt; \u0026lt;style\u0026gt; #back-to-top { display: none; position: fixed; bottom: 20px; right: 55px; width: 55px; height: 55px; border-radius: 7px; background-color: rgba(64, 158, 255, 0.5); box-shadow: var(--shadow-l2); font-size: 30px; text-align: center; line-height: 50px; cursor: pointer; } #back-to-top:before { content: \u0026#39; \u0026#39;; display: inline-block; position: relative; top: 0; transform: rotate(135deg); height: 10px; width: 10px; border-width: 0 0 2px 2px; border-color: var(--back-to-top-color); border-style: solid; } #back-to-top:hover:before { border-color: #2674e0; } /* 在屏幕宽度小于 768 像素时，钮位置调整 */ @media screen and (max-width: 768px) { #back-to-top { bottom: 20px; right: 20px; width: 40px; height: 40px; font-size: 10px; } } /* 在屏幕宽度大于等于 1024 像素时，按钮位置调整 */ @media screen and (min-width: 1024px) { #back-to-top { bottom: 20px; right: 40px; } } /* 在屏幕宽度大于等于 1280 像素时，按钮位置调整 */ @media screen and (min-width: 1280px) { #back-to-top { bottom: 20px; right: 55px; } } /* 目录显示时，隐藏按钮 */ @media screen and (min-width: 1536px) { #back-to-top { visibility: hidden; } } \u0026lt;/style\u0026gt; \u0026lt;!--返回顶部JS --\u0026gt; \u0026lt;script\u0026gt; function backToTop() { document.documentElement.scrollIntoView({ behavior: \u0026#39;smooth\u0026#39;, }) } window.onload = function () { let scrollTop = this.document.documentElement.scrollTop || this.document.body.scrollTop let totopBtn = this.document.getElementById(\u0026#39;back-to-top\u0026#39;) if (scrollTop \u0026gt; 0) { totopBtn.style.display = \u0026#39;inline\u0026#39; } else { totopBtn.style.display = \u0026#39;none\u0026#39; } } window.onscroll = function () { let scrollTop = this.document.documentElement.scrollTop || this.document.body.scrollTop let totopBtn = this.document.getElementById(\u0026#39;back-to-top\u0026#39;) if (scrollTop \u0026lt; 200) { totopBtn.style.display = \u0026#39;none\u0026#39; } else { totopBtn.style.display = \u0026#39;inline\u0026#39; totopBtn.addEventListener(\u0026#39;click\u0026#39;, backToTop, false) } } \u0026lt;/script\u0026gt; 跟随系统 Dark Mode SEO 这么好的博客被地球人错过太可惜了\n参考 \u0026amp; 致谢 Hugo | 看中 Stack 主题的归档功能，搬家并做修改\nHugo Stack 主题折腾笔记\n拥抱最好用的hugo之stack\n『Hugo』Hugo Styles\n","date":"2023-05-11T21:28:27+08:00","permalink":"https://falasool.github.io/2023/custom-hugo-theme-stack/","title":"Hugo｜自定义 hugo-theme-Stack"},{"content":"Nginx 几个重要的Nginx文件和目录 网站内容 /var/www/html：默认的网站内容存放目录，Nginx 默认的欢迎界面就存放在这。可以通过修改Nginx配置文件更改。 服务器配置 /etc/nginx：Nginx配置文件，修改它配置Nginx全局设置。 /etc/nginx/sites-available/：虚拟主机的目录，可在此创建多个虚拟主机。 /etc/nginx/sites-enabled/：Nginx默认站点目录，nginc.conf 默认包含的文件夹。在此文件夹建立的站点，需要建立软连接到目录/etc/nginx/sites-enabled/里。 服务日志 /var/log/nginx/access.log：如无其他设置，此文件记录了每一次的网页服务请求。 /var/log/nginx/error.log：Nginx错误请求记录文件。 ","date":"2023-04-11T21:28:27+08:00","permalink":"https://falasool.github.io/2023/nginx-memos/","title":"Nginx"},{"content":"本次搭建使用 Ubuntu 22.10 系统\n购买 VPS ⚠️不要买机房在大陆的服务商 VPS ⚠️\n在备案通过之前 80 和 443 端口是封禁的 -\u0026gt; 无法申请 SSL 证书 -\u0026gt; Misskey 需要 SSL 才能访问，GG\n（即使没有这个问题，买大陆节点的服务建站也是一种自杀行为）\n注册 注册Vultr 账号，充值\n创建 VPS 选 Cloud Computer\nCPU 选 AMD 和 Intel 都行\n机房位置选择日本、新加坡、美西都行，一般不推荐欧洲（对于中国国内）\n选择操作系统：Ubuntu 22.10 x64\n选择 Size：$5 的 1C1G1TB 套餐（记得勾选 No Thanks）\n关闭自动备份，省 $1\nAdditional Features：勾选 Enable IPv6\n添加 SSH Keys\n打开命令行，输入\n1 ssh-keygen -t rsa -b 4096 -C \u0026#34;Example comment\u0026#34; 在这行提示后面输入你想要保存密钥的路径\n1 2 Generating public/private rsa key pair. Enter file in which to save the key (/home/example_user/.ssh/id_rsa): 我输入（uu是我的电脑用户名）\n1 /home/uu/.ssh/id_rsa_vultr 所以在 /.ssh 目录下可以找到 id_rsa_vultr 和 id_rsa_vultr.pub 文件，它们分别是私钥和公钥\n接下来要把公钥内容添加到 vultr 去\n1 2 3 4 # 进入.ssh 目录 cd .ssh # 打印文件内容 cat id_rsa_vultr.pub 这时底部付款栏应该显示 $5.00/month ，点击 Deploy Now 确认创建服务器，等待一会，等 Status 变成 Running 就好了 点击刚刚创建的 VPS，看到如下界面。\n左下角的 IP Address、Username、Password 是待会连接服务器的时候，要用到的 SSH 连接信息\n登录 VNC：查看控制台 关机：就和关电脑一样（关机的时候仍然在计费哦！） 重启：就和重启电脑一样 重装系统：把服务器重置成刚创建时的状态 销毁/删除：销毁了服务器就不计费了，数据丢失，无法找回 Snapshots：快照，指将当前 VPS 的状态保存下来，对 VPS 进行完整备份\n服务器创建完成\n检查 IP Ping 一下 IP\n用检查工具比如 https://ip112.cn/ 检查 IP，此 IP 可用\n其它测试工具\nhttp://ping.pe/ — 全球节点 Ping，包括中国的三大运营商 http://ping.chinaz.com/ — Ping 检测中国大陆的访问情况 域名 在域名商 Dynadot 注册账号，买一个域名\n解析域名 依次点击\n暂停⏸️\n去 CloudFlare 注册登录账号，依次操作：\n添加新站点\n输入你的域名\n选择免费方案\n添加 DNS 解析记录\n* 是通配符，意思是我的二级域名，xxx.ponderduck.cc 的 DNS 解析也一起被接管了。不用我一个一个设置\n第二行是域名本体\nwww 让输入 www.ponderduck.cc 也能访问\n复制 CloudFlare 提供的两个名称服务器，填进 Dynadot 的 DNS 设置，保存\n回到 CloudFlare 点击 Done, check nameservers，等一会\n测试，ping 你的域名，返回服务器 IP 说明解析生效\n开启完全 SSL，否则访问站点会报「重定向次数过多」的错误\n✅域名解析完成\n服务器基础配置 对哪一步不自信，可以在开始做之前先去服务器管理面板创建一个快照（snapshots），快照就是存档点\n远程连接 1 ssh root@101.113.22.42 # 换成你的ip地址，回车 然后把密码从 vultr 复制过来回车，会看到类似这样的提示就表示连接服务器成功\n1 2 3 4 5 6 7 Welcome to Ubuntu 22.10 (GNU/Linux 5.19.0-23-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage ...省略一部分内容... root@vultr:~# 安全设置 因为 root 权限太太太强大，为了避免婴儿（我）拿核武器发射按钮的情况出现，创建一个普通用户日常使用\n新建普通用户并设定密码 1 adduser vpsadmin # vpsadmin是用户名 然后输入密码 - 确认密码（太简单会被拒绝==）\n赋予 「vpsadmin」 使用 sudo 指令的权限 什么是 su 和 sudo 请看：Linux 的 su 與 sudo 指令教學與範例\n1 sudo adduser vpsadmin sudo 另外开一个终端窗口，登录 vpsadmin 账号\n1 ssh vpsadmin@185.202.62.49 # 换成你的IP，回车，然后输入密码 验证是否获得 sudo 权限\n1 sudo ls -al /root 返回类似内容（展示 /root 目录下的资料）就表示成功了\n[可选]SSH免密登录 每次登录 vpsadmin 都要手动输密码很麻烦，设置一下免密登录\n在 Tabby 设置 - Profiles \u0026amp; connections - + New profile - SSH connection\n禁止 root 登录 （禁用核按钮）\n登录 root 账户，输入\n1 nano /etc/ssh/sshd_config 使用 control + W 进入搜索模式，输入 PerimitRootLogin 并回车，找到所在行，改成（记得要取掉注释 #！！）\n1 PermitRootLogin: no *prohibit-password/without-password 意为禁止密码登录\n使用 control + O，保存更改，control + X 退出\n重新启动 SSH 服务\n1 sudo /etc/init.d/ssh restart 打开一个新窗口，尝试用 root 登录，返回 Permission denied\u0026hellip;\n✅成功禁止 root 登录\n从现在开始，用「vpsadmin」这个账户远程连接 VPS 吧\n搭建环境 修改服务器时间 查看时间\n1 timedatectl 列出所有时区\n1 timedatectl list-timezones 改成香港🇭🇰\n1 sudo timedatectl set-timezone Asia/Hong_Kong 安装常用命令 1 sudo apt-get install curl wget screen tree -y *curl用于请求 Web 服务器\n*wget用来下载软件包\n*screen用于命令行终端的窗口切换\n*tree用于显示当前文件夹的目录结构\n（如果你有其它要用的也一起加进来，或者要用了再用这个命令单独安装也可以）\n添加 SWAP swap 是 Linux 中的虚拟内存，用于在物理内存不足的情况下储存临时数据，可以提升小内存 VPS 的运行效率\n确认是否已存在 SWAP\n1 free -m 有 Swap 项而且 total 列不为零，说明 Swap 已存在，可以自行修改分区容量，参考：为 Linux 添加 swap 分区或修改 swap 分区容量\n配置防火墙 1 2 sudo ufw allow OpenSSH sudo ufw enable 打开防火墙\n1 2 sudo ufw allow http sudo ufw allow https 打开 80、443 的端口\n1 2 sudo ufw allow 80/tcp sudo ufw allow 443/tcp （其它服务需要的端口也用 sudo ufw allow xx/tcp 开启）\n验证防火墙是否打开，端口是否开启\n1 sudo ufw status 和其它服务商不同，Vultr 没有默认防火墙设置，所以要自己开启\n在 Vultr 添加防火墙规则\n安装 Docker 和 Docker Compose *Compose 是 Docker 的一个命令行工具，通过 yml 文件定义、创建、管理多容器的 Docker 应用\n跟着 如何在 Ubuntu 22.04 LTS 中安装 Docker 和 Docker Compose 丝滑完成安装\n推荐：Docker Commands Tutorial | Getting Started With Docker In Linux\n修改 Docker 配置 Docker 的配置文件路径是 /etc/docker/daemon.json，需要手动创建：\n进入 /etc/docker 目录\n1 cd /etc/docker 用 vim 编辑 daemon.json 文件\n1 sudo vim daemon.json 进入 vim 后输入如下内容，这段代码会增加一段自定义内网 IPv6 地址，开启容器的 IPv6 功能，限制日志文件的大小（20M），限制日志文件数量，防止 Docker 日志过多占用硬盘\n（代码来自烧饼博客）\n1 2 3 4 5 6 7 8 9 10 11 { \u0026#34;log-driver\u0026#34;: \u0026#34;json-file\u0026#34;, \u0026#34;log-opts\u0026#34;: { \u0026#34;max-size\u0026#34;: \u0026#34;20m\u0026#34;, \u0026#34;max-file\u0026#34;: \u0026#34;3\u0026#34; }, \u0026#34;ipv6\u0026#34;: true, \u0026#34;fixed-cidr-v6\u0026#34;: \u0026#34;fd00:dead:beef:c0::/80\u0026#34;, \u0026#34;experimental\u0026#34;:true, \u0026#34;ip6tables\u0026#34;:true } ⚠️ vim 和普通键入略有不用\n首先 I 进入编辑模式，输入内容（注意格式：大括号 {} 里的内容除了最后一行，都必须用英文逗号 , 结尾）\n完成输入后，按 esc 回到一般模式\n输入 :wq ，回车（意为保存-离开）\n不放心可以再次进入 daemon.json 检查是否成功写入，效果类似：\n了解：Linux vi/vim 是什么，怎么使用\n重启 Docker 服务\n1 2 sudo systemctl daemon-reload sudo systemctl restart docker 检查 Docker 是否正在运行 1 sudo systemctl status docker 换个方式，再测试一下\n1 sudo docker run hello-world 终于成功了 😭\nMisskey 创建安装目录 之前给 Docker 的数据和配置文件新建一个目录 docker_data，这个文件夹就是包住整个 Misskey 的盒子\n1 sudo mkdir -p data/docker_data 进入目录\n1 cd data/docker_data 创建 misskey 文件夹\n1 sudo mkdir misskey 配置安装文件 进入 misskey 文件夹\n1 cd misskey 创建并编辑 yml 文件，让它去部署\n1 sudo vim docker-compose.yml 按 I，切换到编辑模式，把以下内容粘贴进去\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 # Misskey minimal deploy config version: \u0026#34;3\u0026#34; services: web: restart: unless-stopped # always意味着自动重启，请注意如果您对您的配置没有信心，请不要开启这个选项，以避免进程崩溃反复重启耗费大量资源！ image: misskey/misskey:latest # 这里使用了官方镜像，以避免本地构建时资源不足的问题 container_name: misskey_web # 容器名，方便管理，您可以自行修改为您觉得合适的内容 links: - db - redis ports: - \u0026#34;3001:3001\u0026#34; networks: - internal_network - external_network volumes: - ./config:/misskey/.config:ro # 用于映射配置文件，请根据您的实际配置来决定文件夹名称，设定为只读即可； - ./files:/misskey/files # 用户上传到本地的文件，如果您一开始就接入外部存储（如wasabi或是AWS S3）您可以忽略这块配置 redis: restart: unless-stopped image: redis:latest container_name: misskey_redis networks: - internal_network volumes: - ./redis:/data # redis数据库的数据文件夹映射，创建后默认在 ./redis 文件夹中 db: restart: unless-stopped image: postgres:12.2-alpine container_name: misskey_db networks: - internal_network env_file: - ./config/docker.env # 需要使用配置文件中设置的 Docker 环境变量 volumes: - ./db:/var/lib/postgresql/data # 主数据库的数据文件夹映射，创建后默认在 ./db 文件夹中 networks: internal_network: # 内部网络 internal: true external_network: # 外部网 按 esc ，按 :wq ，回车（保存-退出）\n创建 config/default.yml 目录并进入 yml 文件中\n1 2 3 sudo mkdir config cd config sudo vim default.yml 按 I，切换到编辑模式，填入以下内容\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 #━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ # Misskey configuration #━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ # ┌─────┐ #───┘ URL └───────────────────────────────────────────────────── # Final accessible URL seen by a user. url: https://ponderduck.cc/ # 注意改成自己最后反向代理想要的网址 # ONCE YOU HAVE STARTED THE INSTANCE, DO NOT CHANGE THE # URL SETTINGS AFTER THAT! # ┌───────────────────────┐ #───┘ Port and TLS settings └─────────────────────────────────── # # Misskey requires a reverse proxy to support HTTPS connections. # # +----- https://example.tld/ ------------+ # +------+ |+-------------+ +----------------+| # | User | ---\u0026gt; || Proxy (443) | ---\u0026gt; | Misskey (3000) || # +------+ |+-------------+ +----------------+| # +---------------------------------------+ # # You need to set up a reverse proxy. (e.g. nginx) # An encrypted connection with HTTPS is highly recommended # because tokens may be transferred in GET requests. # The port that your Misskey server should listen on. port: 3001 # ┌──────────────────────────┐ #───┘ PostgreSQL configuration └──────────────────────────────── db: host: db port: 5432 # Database name db: misskey # Auth user: example-misskey-user pass: example-misskey-pass # Whether disable Caching queries #disableCache: true # Extra Connection options #extra: # ssl: true # ┌─────────────────────┐ #───┘ Redis configuration └───────────────────────────────────── redis: host: redis port: 6379 #family: 0 # 0=Both, 4=IPv4, 6=IPv6 #pass: example-pass #prefix: example-prefix #db: 1 # ┌─────────────────────────────┐ #───┘ Elasticsearch configuration └───────────────────────────── #elasticsearch: # host: localhost # port: 9200 # ssl: false # user: # pass: # ┌───────────────┐ #───┘ ID generation └─────────────────────────────────────────── # You can select the ID generation method. # You don\u0026#39;t usually need to change this setting, but you can # change it according to your preferences. # Available methods: # aid ... Short, Millisecond accuracy # meid ... Similar to ObjectID, Millisecond accuracy # ulid ... Millisecond accuracy # objectid ... This is left for backward compatibility # ONCE YOU HAVE STARTED THE INSTANCE, DO NOT CHANGE THE # ID SETTINGS AFTER THAT! id: \u0026#39;aid\u0026#39; # ┌─────────────────────┐ #───┘ Other configuration └───────────────────────────────────── # Whether disable HSTS #disableHsts: true # Number of worker processes #clusterLimit: 1 # Job concurrency per worker # deliverJobConcurrency: 128 # inboxJobConcurrency: 16 # Job rate limiter # deliverJobPerSec: 128 # inboxJobPerSec: 16 # Job attempts # deliverJobMaxAttempts: 12 # inboxJobMaxAttempts: 8 # IP address family used for outgoing request (ipv4, ipv6 or dual) #outgoingAddressFamily: ipv4 # Syslog option #syslog: # host: localhost # port: 514 # Proxy for HTTP/HTTPS #proxy: http://127.0.0.1:3128 #proxyBypassHosts: [ # \u0026#39;example.com\u0026#39;, # \u0026#39;192.0.2.8\u0026#39; #] # Proxy for SMTP/SMTPS #proxySmtp: http://127.0.0.1:3128 # use HTTP/1.1 CONNECT #proxySmtp: socks4://127.0.0.1:1080 # use SOCKS4 #proxySmtp: socks5://127.0.0.1:1080 # use SOCKS5 # Media Proxy #mediaProxy: https://example.com/proxy # Proxy remote files (default: false) #proxyRemoteFiles: true # Sign to ActivityPub GET request (default: false) #signToActivityPubGet: true #allowedPrivateNetworks: [ # \u0026#39;127.0.0.1/32\u0026#39; #] # Upload or download file size limits (bytes) #maxFileSize: 262144000 按 esc ，按 :wq ，回车（保存-退出）\n进入 env 文件\n1 sudo vim docker.env 按 I，切换到编辑模式，填写如下内容\n1 2 3 4 # db settings POSTGRES_PASSWORD=example-misskey-pass POSTGRES_USER=example-misskey-user POSTGRES_DB=misskey 部署 还记得我说「创建并编辑 yml 文件，让它去部署」吗？\n现在文件已经配置完毕了，是时候让它跑起来了！\n双手合十🙏\n切换到上一级目录\n1 cd .. 初始化数据库\n1 sudo docker-compose run --rm web yarn run init 后台启动项目容器\n1 sudo docker-compose up -d 访问站点 查看端口状态\n1 sudo lsof -i:\u0026lt;port\u0026gt; 假如这个端口不能用，那就换一个。\n新端口要在服务商防火墙、ufw 命令、default.yml 和 docker-compose.yml 里都开启、改过来\n然后重启 Docker\n1 sudo docker-compose restart [指定服务的容器] 完成这一步之后，尝试用 IP 访问站点吧\n在浏览器输入 http://\u0026lt;ip\u0026gt;:\u0026lt;port\u0026gt;（IP 可以用 curl ip.sb 返回）\n（；\n还有两个任务\nSSL 证书 反向代理 Nginx 安装 Nginx 1 2 sudo apt update sudo apt install nginx 调整防火墙，允许 Nginx 服务通过\n1 2 3 sudo ufw allow \u0026#39;Nginx HTTP\u0026#39; sudo ufw allow \u0026#39;Nginx HTTPS\u0026#39; sudo ufw allow \u0026#39;Nginx FULL\u0026#39; 查看更改结果\n1 sudo ufw status 查看 Nginx 状态（是 active 就行）\n1 systemctl status nginx 在浏览器输入 http://your_vps_ip，返回 Nginx 默认页面\n让 Nginx 在系统启动时自动启动\n1 sudo systemctl enable nginx 设置服务器块 创建站点对应目录\n1 sudo mkdir -p /var/www/ponderduck.cc/html 使用$USER环境变量分配目录的所有权\n1 sudo chown -R $USER:$USER /var/www/ponderduck.cc/html 如果我们没有修改自己的umask值，那么 Web 根目录的权限应该正确，我们可以通过输入以下命令来确认：\n1 sudo chmod -R 755 /var/www/ponderduck.cc 编辑index.html\n1 sudo vim /var/www/ponderduck.cc/html/index.html 添加以下示例HTML\n1 2 3 4 5 6 7 \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;Welcome to ponderduck.cc!\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;h1\u0026gt;Success! The ponderduck.cc server block is working!\u0026lt;/h1\u0026gt; \u0026lt;/body\u0026gt; 为 Nginx 创建一个服务器块\n创建一个新文件\n1 sudo vim /etc/nginx/sites-available/ponderduck.conf 添加以下内容\n1 2 3 4 5 6 7 8 9 10 server { listen 80; listen [::]:80; root /var/www/ponderduck.cc/html; index index.html index.htm index.nginx-debian.html; server_name ponderduck.cc www.ponderduck.cc; location / { try_files $uri $uri/ =404; } } 通过 ls 命令在sites-enabled目录新建一个链接，好让 Nginx 在启动过程中会读取这个目录：\n1 sudo ln -s /etc/nginx/sites-available/ponderduck.conf /etc/nginx/sites-enabled/ 打开文件：\n1 sudo vim /etc/nginx/nginx.conf 找到server_names_hash_bucket_size指令并删除#符号：\n1 2 3 4 5 6 7 ... http { ... server_names_hash_bucket_size 64; ... } ... 接下来，测试以确保我们在 Nginx 文件中的改动，没有任何问题：\n1 sudo nginx -t 如果没有任何问题，请重新启动 Nginx：\n1 sudo systemctl restart nginx 现在通过 http://ponderduck.cc 访问服务器的时候，Nginx 会指向我们刚刚添加的那个 HTML 页面\nSSL 安装 Certbot 我们需要获得被信任的证书授权中心（ CA ）签发的安全证书。Let’s Encrypt 是 ISRG （ Internet Security Research Group ，互联网安全研究小组）的组织推出的免费安全证书计划。\nISRG 的发起者 EFF （电子前哨基金会）为 Let’s Encrypt 项目发布了一个官方的客户端 Certbot ，利用它可以完全自动化的获取、部署和更新安全证书\n安装 Certbot\n去 官网 选择我正在使用的 Web 服务器（Nginx）和操作系统（Ubuntu 20），操作对应的安装步骤\nUbuntu 自带 Snap，用 Snap 安装 Certbot\n1 sudo snap install --classic certbot 用 ln 命令创建符号连接，将 Certbot 加入 PATH 环境变量中\n1 sudo ln -s /snap/bin/certbot /usr/bin/certbot 生成 SSL 证书 1 sudo certbot --nginx -d www.ponderduck.cc 输入邮箱地址，用于接收邮件\n输入 Y，同意协议；询问是否接收前哨基金会的邮件，接不接收都行\n返回（注意证书储存位置）\n1 2 3 4 5 6 Successfully received certificate. Certificate is saved at: /etc/letsencrypt/live/www.ponderduck.cc/fullchain.pem Key is saved at: /etc/letsencrypt/live/www.ponderduck.cc/privkey.pem This certificate expires on 2023-02-18. These files will be updated when the certificate renews. Certbot has set up a scheduled task to automatically renew this certificate in the background. Let\u0026rsquo;s Encrypt 的 SSL 证书会在 90 天后过期，但是 Certbot 会自动续订\n测试证书自动续订是否生效\n1 sudo certbot renew --dry-run 返回⬇️说明已生效\n1 Simulating renewal of an existing certificate for www.ponderduck.cc 找到存放站点证书的目录\n1 sudo ls /etc/letsencrypt/live 我的是www.ponderduck.cc 查询证书\n1 sudo ls /etc/letsencrypt/live/www.ponderduck.cc 返回文件名\n1 cert.pem chain.pem fullchain.pem privkey.pem 后两个要添加到 Nginx 配置文件 .conf 里\n反向代理 修改网站配置文件\n参考 官网文档，以下是我的完整文件内容\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 # For WebSocket map $http_upgrade $connection_upgrade { default upgrade; \u0026#39;\u0026#39; close; } proxy_cache_path /tmp/nginx_cache levels=1:2 keys_zone=cache1:16m max_size=1g inactive=720m use_temp_path=off; server { listen 80; listen [::]:80; server_name www.ponderduck.cc ponderduck.cc; # For SSL domain validation root /var/www/html; location /.well-known/acme-challenge/ { allow all; } location /.well-known/pki-validation/ { allow all; } location / { return 301 https://$server_name$request_uri; } } server { listen [::]:443 ssl http2; listen 443 ssl http2; server_name ponderduck.cc www.ponderduck.cc; ssl_session_cache shared:ssl_session_cache:10m; # ssl ssl_certificate /etc/letsencrypt/live/www.ponderduck.cc/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/www.ponderduck.cc/privkey.pem; include /etc/letsencrypt/options-ssl-nginx.conf; ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; ssl_stapling on; ssl_stapling_verify on; # Change to your upload limit client_max_body_size 80m; # 对\u0026#34;/\u0026#34;启用反向代理 location / { # 指定转发地址 proxy_pass http://127.0.0.1:3001; proxy_set_header Host $host; proxy_http_version 1.1; proxy_redirect off; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $connection_upgrade; proxy_cache cache1; proxy_cache_lock on; proxy_cache_use_stale updating; add_header X-Cache $upstream_cache_status; } } 接下来，测试以确保我们在 Nginx 文件中的改动，没有任何问题：\n1 sudo nginx -t 有问题的话按照提示修改，做完之后，重新启动 Nginx：\n1 sudo systemctl restart nginx 现在 SSL 证书和反向代理都生效了，尝试用域名访问站点\n完成🎉\n注册一个账号，回到命令行工具把它设置为管理员\n日常维护 更新 Docker-compose 部署\n1 2 3 4 5 6 7 8 9 10 11 cd data/docker_data/misskey docker-compose down cp -r /root/data/docker_data/misskey /root/data/docker_data/misskey.archive # 万事先备份，以防万一，其实这边没必要，因为我们没有映射到本地文件夹 docker-compose pull docker-compose up -d # 请不要使用docker-compose stop来停止容器，因为这么做需要额外的时间等待容器停止；docker-compose up -d直接升级容器时会自动停止并立刻重建新的容器，完全没有必要浪费那些时间。 docker image prune # prune 命令用来删除不再使用的 docker 对象。删除所有未被 tag 标记和未被容器使用的镜像 提示：\n1 2 WARNING! This will remove all dangling images. Are you sure you want to continue? [y/N] 输入 y\n卸载 1 2 3 4 5 cd /root/data/docker_data/misskey docker-compose down rm -rf /root/data/docker_data/misskey # 完全删除映射到本地的数据 删除旧数据 1 docker system prune 磁盘空间分析及清理 内容主要来源：https://www.cnblogs.com/jing99/p/10487174.html\n有时候要用 sudo\ndf 命令 可以查看一级文件夹大小、使用比例、档案系统和挂入dian\n1 2 3 4 5 6 7 8 [root@oms ~]# df -Th Filesystem Type Size Used Avail Use% Mounted on /dev/vda1 ext4 40G 35G 3.1G 92% / devtmpfs devtmpfs 1.9G 0 1.9G 0% /dev tmpfs tmpfs 1.9G 0 1.9G 0% /dev/shm tmpfs tmpfs 1.9G 191M 1.7G 11% /run tmpfs tmpfs 1.9G 0 1.9G 0% /sys/fs/cgroup tmpfs tmpfs 379M 0 379M 0% /run/user/0 七个字段分别为档案系统、类型、该分割区的容量、已使用的大小、剩下的大小、使用的百分比和挂入点\ndu命令 用来查看目录或文件所占用磁盘空间的大小。常用选项组合为：du -sh [目录]\n1 2 3 4 5 6 du -s 目录 | sort -rn #这是按字节排序 du -sh 目录 | sort -rn #这是按兆（M）来排序 #由于-sh大小显示看起来是乱的，因此建议使用du -s|sort -nr du -s 目录 | sort -rn | head #选出排在前面的10个 du -s 目录 | sort -rn | tail #选出排在后面的10个 常用选项\n-h：以人类可读的方式显示\n-a：显示目录占用的磁盘空间大小，还要显示其下目录和文件占用磁盘空间的大小\n-s：只显示目录占用的磁盘空间大小，不显示其子目录和文件占用的磁盘空间大小\n-c：显示几个目录或文件占用的磁盘空间大小，还要统计它们的总和\n\u0026ndash;apparent-size：显示目录或文件自身的大小(文件或目录占用磁盘空间的大小与它们自身大小有时候并非完全一致)\n-l ：统计硬链接占用磁盘空间的大小\n-L：统计符号链接所指向的文件占用的磁盘空间大小。\nrm 命令 慎用\n以下待做：\nhttps://fediverse.eu.org/discussion/15/%E7%BB%99%E6%96%B0%E7%AB%99%E9%95%BF-%E5%BB%BA%E7%AB%99%E5%90%8E%E5%8F%AF%E5%8F%82%E8%80%83%E7%9A%84%E8%BF%90%E7%BB%B4%E5%8F%8A%E8%A3%85%E4%BF%AE%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C#latest\nhttps://pullopen.github.io/tags/#Mastodon\n扫描出不属于任何媒体附件的文件并移除他们 清除缓存存储 从数据库中删除未被引用的嘟文，例如来自中继的或来自本地用户不再关注的用户的嘟文，同时没有被回复的或以其他方式与之互动的 常用命令 查看 docker 容器状态\n1 sudo docker container stats 其它参考 mjj版的linux入门教程\n[User] Linux 新增使用者並賦予其使用 sudo 的權限\n保护好你的小鸡！保姆级服务器安全教程！\n【好玩儿的Docker项目】10分钟搭建一个去中心化微博平台——Misskey ｜二次元风格、联邦宇宙\n使用Docker最小化部署Misskey\n搭建属于自己的去中心化社交平台 Misskey\n如何在 Ubuntu 20.04 中安装和配置 Nginx\nNginx 教程：如何在 Ubuntu 20.04 下安装并配置 Nginx\n如何在Ubuntu 20.04 Nginx配置Let\u0026rsquo;s Encrypt SSL证书\n","date":"2022-11-19T20:19:15+08:00","permalink":"https://falasool.github.io/2022/misskey/","title":"Misskey 实例搭建教程"},{"content":" 安装 PicGo 1 brew install picgo --cask 创建 GitHub 图床仓库 名称无所谓，记得勾选 README\n生成令牌（Token） 在 Account-Settings-Developer Settings-Personal Access Tokens 下生成（勾选 repo）并保存，我的Token：\n配置 PicGo 自定义域名是：https://cdn.jsdelivr.net/gh/\u0026lt;github用户名\u0026gt;/\u0026lt;图床仓库名\u0026gt;@\u0026lt;仓库版本号\u0026gt;/\n测试图床 [可选] 用 Squoosh 把图片转格式（webp）并压缩\n设置成功后直接把图片放进 Typora 就OK\n锵锵～请看！！\n相关参考 PicGo\n我写博客都用了哪些工具？\n","date":"2022-10-21T23:29:38+08:00","permalink":"https://falasool.github.io/2022/picture-bed/","title":"Hugo | 给博客配置图床"},{"content":"基于 macOS Monterey，Hugo 框架和 GitHub Pages 网页寄存服务，博客主题为 Stack，搭建过程尽量简单，同时减少后续隐患\n预警：非常啰嗦\n前期准备 安装 Hugo 1 2 3 4 5 6 7 # 安装 brew install hugo # 检查安装是否成功 hugo version # 返回⬇️ hugo v0.104.1+extended darwin/arm64 BuildDate=unknown 安装 Git 在 Git 下载、安装程序，按默认选项安装即可\n设置你的用户名和邮件地址\n1 2 3 # 填你的 GitHub ID 和注册邮箱 git config --global user.name \u0026#34;\u0026lt;username\u0026gt;\u0026#34; git config --global user.email user@example.com GitHub https://raw.githubusercontent.com/Falasool/blog-pic-bed/main/blog/new-public-repo-1.png\nhttps://raw.githubusercontent.com/Falasool/blog-pic-bed/main/blog/image-20221115113949496.png\n创建公开仓库 存放编译好的静态页面\n创建私密仓库 存放源码\n给两个仓库绑定 SSH key 生成 SSH key 1 ssh-keygen -t rsa -b 4096 -C \u0026#34;user@example.com\u0026#34; 这行命令 means：生成 SSH 密钥文件 - 密钥类型（rsa）- 密钥长度（4096） - 注释（user@example.com）\n在 .ssh 文件夹里找到生成的 SSH\n添加公钥：把 public key id_rsa_hugo_deploy.pub 添加到 .github.io 仓库: 1 2 cd .ssh cat id_rsa_hugo_deploy.pub # 显示文件内容 添加私钥：Private Key 添加到 private仓库： 这里 Secrets 变量名要一定是： ACTIONS_DEPLOY_KEY 绑定 Token 在 Account- Settings- Developer Settings- Personal access tokens-Tokens(classic) 里创建 Token，记得勾选 repo 和 workflow，并复制保存。我的 Token: （隐藏） 在私有仓库 hugo-scources-settings-secrets-Actions 创建名为PERSONAL_TOKEN，值为刚才的 Token 的Secret，这样就完成了 Token 的设置 搭建步骤 克隆 private 仓库到本地 新建 Hugo 站点 在本地 hugo-sources 文件夹中执行 ⬇️，在当前目录生成 Hugo 源码\n1 hugo new site . --force 找到 blog 文件夹，打开会发现结构如下\n1 2 3 4 5 6 7 8 9 blog ├── archetypes # 配置文件，决定创建新博文时的自带格式 │ └── default.md ├── config.toml # 网站配置文件 ├── content # 网站内容，全部是 markdown 格式 ├── data ├── layouts # 网站模板，优先于 themes/\u0026lt;THEME\u0026gt;/layouts ├── static # 静态资源（css/js/fonts/media等） └── themes Hugo 主题 有了主题，内容才会渲染出来\n在 github.com 搜索 hugo theme ，或在 Hugo Themes 选择你喜欢的主题。我选择 stack ，功能丰富，支持多种评论系统，使用人数多bug好解决\nfork 主题仓库，并使用 git submodule 方式添加到 themes 里，这样方便后续对主题的修改进行单独维护 1 2 3 # 在hugo-sources目录下 git init git submodule add https://github.com/Falasool/hugo-theme-stack themes/hugo-theme-stack 更新主题： 1 2 3 4 # 初始化 git submodule update --init --recursive # 同步主题仓库的最新修改 git submodule update --remote 删除根目录下的config.toml 文件，把 ./themes/hugo-theme-stack/exampleSite/ 里的 config.yaml 和 content 转移到根目录下，在 config.yaml 中进行站点细节配置 删掉 examplesite/content/post/rich-content/index.md，因为Twitter 等等被墙应用的API 中国大陆无法访问 Issus #191@CaiJimmy/hugo-theme-stack 本地预览 1 2 hugo server -D # 在浏览器打开localhost:1313 预览满意了 Control+C 终止预览 推送到 GitHub 1 2 3 git add . git commit -m \u0026#34;first commit\u0026#34; git push -u origin main GitHub Actions 配置 在 GitHub 的 Private 仓库页面，切换到 Actions tab，点击set up a workflow yourself，粘贴以下文件，并 commit 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 name: Deploy Hugo Site to Github Pages on Main Branch on: push: branches: - main workflow_dispatch: schedule: # Runs everyday at 8:00 AM - cron: \u0026#34;0 0 * * *\u0026#34; jobs: build-deploy: runs-on: ubuntu-latest steps: - name: Checkout uses: actions/checkout@v2 with: submodules: true fetch-depth: 0 - name: Setup Hugo uses: peaceiris/actions-hugo@v2 with: hugo-version: \u0026#39;0.104.1\u0026#39; # 查看你的版本把它替换掉，防止兼容问题 extended: true - name: Build run: hugo --minify - name: Deploy uses: peaceiris/actions-gh-pages@v3 with: PERSONAL_TOKEN: ${{ secrets.PERSONAL_TOKEN }} # 这里的 ACTIONS_DEPLOY_KEY 则是上面设置 Private Key的变量名 external_repository: Falasool/Falasool.github.io # Pages 远程仓库 publish_dir: \u0026#34;./public\u0026#34; keep_files: false # remove existing files publish_branch: main # deploying branch commit_message: ${{ github.event.head_commit.message }} cname: anodicseal.xyz # 这里要改成你的个人域名，没有就把这行注释掉 在本地 hugo-sources 目录下执行 git pull origin main，查看本地文件夹，出现了 .github/workflows/main.yml 文件 检查流水线是否被正常触发（查看流水线日志） 博客搭建完成\n使用步骤 1 2 3 4 5 6 7 8 9 # 新建文章 hugo new post/\u0026lt;title\u0026gt;.md # 打开\u0026lt;title.md\u0026gt;，编辑并保存 # 本地预览 hugo server -D # 没问题了就push到远程仓库，Actions会自动部署 git add . git commit -m \u0026#34;test\u0026#34; git push origin main 拓展 Github Actions 实现的三种方案：\ngithub_token deploy_key personal_token 适用情况和差异请参考 官方文档\n相关参考 Hugo 搭建博客实践\nGit Submodule 命令与理解\nGithub Pages + Hugo 搭建个人博客\n自动发布系统\nGitHub Actions 入门教程\nWorkflow syntax for GitHub Actions\nCI/CD是什麼？一篇認識CI/CD工具及優勢，將日常瑣事自動化\nHugo + GitHub Action，搭建你的博客自动发布系统\nHugo 搭配 Github Actions 實現 Github Pages 的自動部署\n利用GitHub Action实现Hugo博客在GitHub Pages自动部署\nGitHubAction + Hugo 自动构建发布个人博客\n使用 Github Actions 自动发布 hugo 站点\n***\n折腾Hugo | GitHub Pages | Github Actions自动构建发布免费个人网站\n将Hugo静态网站部署到Github Pages\n用 Hugo 配合 GitHub Actions 和 GitHub Pages 搭建博客\n","date":"2022-10-21T21:28:27+08:00","permalink":"https://falasool.github.io/2022/build-hugo-site-on-macos/","title":"Hugo｜Github Pages｜Stack主题｜搭建记录"},{"content":" Update：用过 Cataus、Disqus，Cataus 和同名主题配合起来很可爱，用了一段时间 Disqus 后对它的 UI 不太满意，再加上强制登录比较恼人，就换成象友推荐的 Twikoo 试试\nTwikoo 设置数据库 MongoDB 按照 官方文档 ，我用的 Vercel 部署\n创建数据库，选 Free 方案，区域选择 AWS / N. Virginia (us-east-1)，设置并保存好用户名和密码\n在 Where would you like to connect from? 这一步填 0.0.0.0，然后点 Add Entry，最后确认创建数据库\n进入数据库，connect - Drivers - Node.js，把实例的用户名和密码改成自己的，例如：\n1 mongodb+srv://twikoo:fhahflanclal3o2u0@cluster0.tke1htc.mongodb.net/?retryWrites=true\u0026amp;w=majority Vercel 部署 按照文档的一键部署，等待\u0026hellip;\n在控制台 - settings - Environment Variables，添加环境变量 MONGODB_URI，值为之前的数据库连接字符串\n进入 Deployments , 然后在任意一项后面点击更多（三个点） , 然后点击Redeploy , 最后点击下面的Redeploy\n访问 Vercel 分配的域名，如果环境配置正确，可以看到 “Twikoo 云函数运行正常” 的提示\n配置到博客 1 2 3 4 5 6 comments: enabled: true provider: twikoo twikoo: envId: https://twikoo.vercel.app/ 部署成功后点右下角↘️的齿轮⚙️图标，设置管理密码\n更新 管理页面提示：Client version: 1.5.11， Server version: 1.6.16， 请参考 版本更新 进行升级\n在 twikoo.html 里把引入的js文件版本修改到1.6.16\nDisqus 选择 Disqus 是因为 Hugo 内置了它的模板，同时它对迁移的支持较好，本身功能非常齐全，比较遗憾的是从 2015 年开始被墙了\n参考 官方文档\n基础设置 在 Disqus 注册并登录账号，添加站点（选择I want to install Disqus on my site）\n输入你想要的 Website Name，用作插入 config 文件的名字，后期可以在 Disqus -\u0026gt; Setting -\u0026gt; General 下查看和修改\n在 Configure Disqus for Your Site 页面输入 Website URL，要输入完整的地址，比如如果像我一样使用的是 GitHub Pages ，就要加上 https:// 的协议名；\n选择 Category，点击 Create Site 完成注册\n选择方案，我选 free\n编辑博客的配置文件 config.yaml，添加 disqusShortname 设置\n1 2 # 在第 23 行左右 disqusShortname: YOURSITENAME 可选项 添加可信域 Disqus 的站点名称是公开的，如果要防止被别人滥用，可以进行域名绑定，只允许信任的域名使用你的评论\n在 Disqus -\u0026gt; Site -\u0026gt; Advanced 添加 Trusted Domains\n特定博文开启/关闭评论 https://lvv.me/posts/2019/12/10_hugo_disqus/\n相关参考 感谢前人的耕耘和分享，希望本文也能给你带来一些帮助 ❤️\n在静态博客里添加Twikoo评论系统，并配置邮箱和TG通知\n科学使用 Disqus\nDisqus评论框改造工程-实现 Disqus 代理的 Serverless 服务\nDisqusJS - 一个超轻量级的 DISQUS「评论基础模式」的实现\n给 Hugo 开启 Disqus 评论系统\n","date":"2022-10-14T19:12:42+08:00","permalink":"https://falasool.github.io/2022/hugo-comment-system-disqusjs/","title":"Hugo | 给博客添加评论系统"},{"content":"什么是 Front Matter 是指 .md 文件最上面的这一部分内容\n1 2 3 4 5 6 --- title: xxxxxx date: 2022-10-10 09:39:50 type: tags layout: tags= --- 每次执行 hugo new 命令新建文章时，Hugo 会从 ./archetypes 中寻找对应的 Front Matter 模板并自动添加到新建文件的最上方\nFront Matter 里的参数定义了所在博文的外观、功能\n常用 Front Matter 设置 没有兴趣客制化可以复制以下代码，添加进 ./archetypes/default.md 文件\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 --- # 使用时需删除注释和空行 # 创建和文件名相同的文章标题 title: \u0026#34;{{ replace .Name \u0026#34;-\u0026#34; \u0026#34; \u0026#34; | title }}\u0026#34; description: \u0026#34;\u0026#34; # 优化 URL slug: \u0026#34;{{ replace .Name \u0026#34;-\u0026#34; \u0026#34; \u0026#34; | title }}\u0026#34; author: [\u0026#34;Rubberduck\u0026#34;] type: post/draft/page date: {{ .Date }} draft: false # 随机匹配一张图片 image: https://picsum.photos/800/600.webp?random={{ substr (md5 (.Date)) 4 8 }} categories: [\u0026#34;Tutorials\u0026#34;] tags: [\u0026#34;Hugo\u0026#34;,\u0026#34;tech\u0026#34;] keywords: [\u0026#34;tutorials\u0026#34;, \u0026#34;Hugo\u0026#34;, \u0026#34;mac\u0026#34;,\u0026#34;tech\u0026#34;] metaAlignment: center coverMeta: in/out coverSize: partial coverCaption: \u0026#34;文章cover图片描述\u0026#34; isCJKLanguage: true --- 下面具体说明各项参数，\nFront Matter 内容 参数 描述 title 标题，默认与文件名一致 date 默认为文件创建日期 type 文章类别，可选post/page/draft等等 slug 指定文章网址 update 文件更新日期 lastmod 文章最后更新日期 description 文章描述，会被抓去做SEO放在HTML的header中 categories 分类（不适用于分页） tags 标签（不适用于分页） hidden 是否隐藏文章，值为 true 时输入正确网址就可以查看 draft 是否为草稿，值为 true 时 Hugo 不编译这个文件 layout 指定文章使用的模板，不指定的话会使用 根目录/_config.toml 中的默认配置 default_layout:post comments 开启文章评论功能，默认为 true permalink 覆盖文章网址 coverImage 设置文章封面图片 metaAlignment 设置文章title的位置 coverMeta 文章title放在封面图片中央还是外面 coverSize 封面图片大小 如果需要添加 Hugo 创建的 .md 文件的 Front Matter 模板没有的参数，可以编辑 archetypes 文件夹下的 default.md 文件\n更多请参考官方文档 Hugo｜Front Matter\n相关参考 感谢前人的耕耘和分享，希望本文也能给你带来一些帮助 ❤️\n貼身打造個人部落格 - 02. 文章 Front Matter\nHugo之路 2 | hugo-theme-stack 配置 —— 参考了匹配随机图片的代码\n","date":"2022-10-12T20:08:18+08:00","permalink":"https://falasool.github.io/2022/hugo-front-matter/","title":"Hugo | Front Matter"},{"content":"前期准备 安装 Hugo 打开 Github 中的 Hugo 库，下载最新的版本，本次下载：hugo_extended_0.99.1_Windows-64bit.zip 因为一些主题需要进行 SCSS/SASS 构建，所以推荐下载 extended 版本，普通版本可能会报错：you need the extended version to build SCSS/SASS 配置环境变量 在 控制面板 -\u0026gt; 系统 -\u0026gt; 高级系统设置 -\u0026gt; 高级 中找到环境变量 在用户变量中找到 Path 变量，点击编辑，在弹出的窗口中选择新建，输入 Hugo.exe 文件的文件夹路径（不要包括 Hugo.exe 本身） 测试配置是否成功：在 E:\\ 空白处右键，点击 Git Bash Here ，在命令行中输入 hugo version ，若返回 Hugo 版本号信息，说明配置成功 安装 Git 在 Git 下载、安装程序，按默认选项安装即可\n设置 在开始菜单找到 Git Bash ，打开输入：\n1 2 git config --global user.name \u0026#34;Your Name\u0026#34; git config --global user.email \u0026#34;email@example.com\u0026#34; 配置 SSH SSH 密钥用来链接本地和 Git 服务器，它成对生成，分别是” 公钥 “和” 私钥 “，我们将其中的” 公钥 “保存到 Git 仓库后，就可以在电脑上向这个 Git 仓库提交代码。\n生成 SSH 在 Git Bash Here 里输入：\n1 ssh-keygen -t rsa -C\u0026#34;注册 github 账号时使用的邮箱\u0026#34; 按照系统提示指定密钥位置、是否需要密码，懒得设置可以直接回车，显示如下结果说明 SSH 生成成功：\n1 2 Your identification has veen saved in id_rsa Your public key has been saved in id_rsa.pub 连接 SSH 在 C:/Users/用户名/.ssh/ 路径找到公钥 id_rsa.pub ，右键用记事本打开，复制全部内容到 Github 账号 -\u0026gt; Settings -\u0026gt; SSH and GPG keys ，新建一个 SSH 密钥，把公钥粘贴保存 测试 SSH 连接是否完成，在 Git Bash Here 输入：\n1 ssh -T git@github.com 如果返回：\n1 Hi username!YOu\u0026#39;ve successfully authenticated,but GitHub does not provide shell access. 说明 SSH 连接成功\n创建 Github 仓库 注意仓库名要和 GitHub 用户名一致，比如你是 xiaohong，那么你要输入 xiaohong.github.io ，最终仓库的完整名是 xiaohong/xiaohong.github.io\n安装 VSCode Visual Studio Code (简称 VS Code / VSC) 是一款免费开源的现代化轻量级代码编辑器\n在 官方下载地址 选择相应的版本下载，按照默认选项安装，安装汉化插件 Chinese (Simplified) Language Pack for Visual Studio Code\n安装 Typora（可选） Typora 是一款轻型 MarkDown 编辑器，其实 VSCode 安装 md 插件后也能胜任它的工作，但是我们就让专业的 Typora 做专业的事吧\n在官网 releases 页面购买，或点击 Dev/Beta Released -\u0026gt; 下拉到底端 old macOS beta/old Windows/Linux beta 下载 beta 版\n⚠️ 建议在偏好设置里，设置插入图片时复制到指定路径（./xx/），这样复制的图片就会自动保存在当前文件夹下的xx文件夹里，方便后续管理与转移。\n开始建站 新建 Hugo 网站 新建一个文件夹用来存放 Hugo 网站的文件，例如：H:/HugoWebsite 在 HugoWebsite 文件夹内空白处点击右键，选择 Git Bush Here ，执行以下命令，新建一个 Hugo 网站 1 hugo new site blog # blog是网站文件夹名 选择 Hugo 主题 在 github.com 搜索 hugo theme ，或在 Hugo Themes 选择你喜欢的主题。此处以 cactus 举例\n⚠️ 推荐将主题仓库 fork 到自己的账号，使用 git submodule 方式进行仓库连接，这样方便后续对主题的修改进行单独维护（否则\n1 2 3 cd blog git init git submodule add https://github.com/monkeyWzr/hugo-theme-cactus themes/hugo-theme-cactus ⚠️ git clone 命令也可以，就是修改可能会和原主题冲突，不方便版本管理和后续更新，在文件夹 blog 空白处右键点击 Git Bush Here\n1 2 3 4 5 # 进入 themes 目录，如果没有这个文件夹用 mkdir -p themes 自行创建 cd themes # 下载主题到 cactus 文件夹下 git clone git@github.com:monkeyWzr/hugo-theme-cactus.git 配置主题 备份 blog 文件夹里的 config.toml 文件，用 blog/themes/hugo-theme-cactus/exampleSite/ 下的 config.toml 覆盖 blog 文件夹下的 config.toml ，然后打开 config.toml 修改配置\n必要的修改 1 2 3 4 5 # 修改 URL 为你的 GitHub 仓库名称 baseURL = \u0026#34;https://username.github.io\u0026#34; # 这里必须和 themes 文件夹里的主题文件夹名称一致，所以把主题文件名从 hugo-theme-cactus 修改为 cactus theme = \u0026#34;cactus\u0026#34; 本地预览 新建文章 在网站文件根目录：E:\\HugoWebsite\\blog 下执行：\n1 hugo new post/first_article.md 到 blog/content/post 里打开并编辑文章内容，保存\n启动 Hugo server 1 hugo server -D 打开网址 http://localhost:1313/ 进行预览，在 config.toml 里调整页面效果\n部署到 GitHub 进入 E:\\HugoWebsite\\blog\\public 目录，初始化 Git 库\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # 进入 public 文件夹 cd public # 初始化 git init # 将 git 本地库关联至远程库 git remote add origin git@github.com:username/username.github.io.git # 提交修改 git commit -m \u0026#34;firstarticle\u0026#34; # 查看当前修改状态 git status # 添加所有修改过的文件 git add . # 提交到本地库，\u0026#34;add first-post\u0026#34;是本次提交内容的说明信息 git commit -m\u0026#34;add first-post\u0026#34; # 提交到远程库 git push origin main ✨ 曾经 github 的默认分支是 master，时间比较久的教程「提交到远程库」这一步都是git push origin master ，这里要注意\n日常使用博客要知道的 Front Matter 什么是 Front Matter 是指 .md 文件最上面的这一部分内容\ntitle: tags\ndate: 2019-08-13 09:39:50\ntype: tags\nlayout: tag\nFront Matter 内容 参数 描述 title 标题，默认与文件名一致 date 默认为文件创建日期 slug 指定文章网址 update 文件更新日期 lastmod 文章最后更新日期 description 文章描述，会被抓去做SEO放在HTML的header中 categories 分类（不适用于分页） tags 标签（不适用于分页） hidden 是否隐藏文章，值为 true 时输入正确网址就可以查看 draft 是否为草稿，值为 true 时 Hugo 不编译这个文件 layout 指定文章使用的模板，不指定的话会使用 根目录/_config.toml 中的默认配置 default_layout:post comments 开启文章评论功能，默认为 true permalink 覆盖文章网址 coverImage 设置文章封面图片 metaAlignment 设置文章title的位置 coverMeta 文章title放在封面图片中央还是外面 coverSize 封面图片大小 如果需要添加 Hugo 创建的 .md 文件自带的 Front Matter 模板没有的参数，可以编辑 archetypes 文件夹下的 default.md 文件\n更多请参考Hugo｜Front Matter\n如何新建或修改博文 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # 在根目录：E:/HugoWebsite/blog 下新建文章或编辑文章 hugo new post/title.md # 本地预览，http://localhost:1313/ hugo server -D # 构建 Hugo 网站 hugo # 切换到目录：E:/HugoWebsite/blog/public cd public # 提交修改到本地库 git add . git commit -m\u0026#34;commit info\u0026#34; # 把内容拉下来以rebase方式合并 git pull --rebase # 将修改推到远程库 git push -u origin main 如何删除文章 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # 在目录 E:/HugoWebsite/blog/content/post 和 E:/HugoWebsite/blog/public 找到对应文章删除 # 其中public下文件不删除不会影响显示，只是文件就会一直存在，除.git删错了也不要紧，hugo命令会重建 # 本地预览，http://localhost:1313/ hugo server -D # 构建 Hugo 网站 hugo # 切换到目录：E:/HugoWebsite/blog/public # 提交修改到本地库 git add . git commit -m\u0026#34;commit info\u0026#34; # 把内容拉下来以rebase方式合并 git pull --rebase # 将修改推到远程库 git push -u origin main 装修没有止境 评论系统用 cactus，原装！可爱！\n（202210:换了主题所以不再补充了）\n报错和解决方法 相关参考 感谢前人的耕耘和分享，希望本文也能给你带来一些帮助 ❤️\nGithub Pages + Hugo 搭建个人博客\nHugo | 一起动手搭建个人博客吧\n记录一下如何用 Hugo 和 Github Page 建立简单的博客 Blog\nHugo 从入门到会用\n小白如何低成本建立个人网站或作品集（详细教程）\n使用 Hugo 和 GitHub 搭建博客\n***\nfront-matter 使用详解\nhugo 建站全指南 | 我的第一个博客网站\n在静态网站上包含评论的各种方法\n***\n為你自己學Git｜怎麼有時候推不上去\nGit 把本地仓库与 GitHub 远程仓库关联进行同步\n将 Git 默认分支从 master 修改为 main\n","date":"2022-10-12T16:06:44+08:00","permalink":"https://falasool.github.io/2022/build-blog-site-use-hugo-win/","title":"Hugo | 初次搭建记录"},{"content":"","date":"0001-01-01T00:00:00Z","permalink":"https://falasool.github.io/1/","title":""}]
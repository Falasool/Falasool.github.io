<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Akkoma on Rubber Duck's Bizarre Adventure</title><link>https://falasool.github.io/categories/akkoma/</link><description>Recent content in Akkoma on Rubber Duck's Bizarre Adventure</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Sat, 15 Jul 2023 22:59:59 +0800</lastBuildDate><atom:link href="https://falasool.github.io/categories/akkoma/index.xml" rel="self" type="application/rss+xml"/><item><title>Migrate to Akkoma</title><link>https://falasool.github.io/2023/migrate-to-akkoma/</link><pubDate>Sat, 15 Jul 2023 22:59:59 +0800</pubDate><guid>https://falasool.github.io/2023/migrate-to-akkoma/</guid><description>&lt;img src="https://picsum.photos/800/600.webp?random=040d4a09" alt="Featured image of post Migrate to Akkoma" />&lt;p>Update system&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">apt update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt full-upgrade
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>安装依赖&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">apt install git build-essential postgresql postgresql-contrib cmake libmagic-dev
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install elixir erlang-dev erlang-nox
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt install imagemagick ffmpeg libimage-exiftool-perl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>🕙：elixir 要求1.14版本，查看版本，不对的话升级&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">elixir --version
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">git clone https://github.com/asdf-vm/asdf.git ~/.asdf --branch v0.8.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;. &lt;/span>&lt;span class="nv">$HOME&lt;/span>&lt;span class="s2">/.asdf/asdf.sh&amp;#34;&lt;/span> &amp;gt;&amp;gt; ~/.bashrc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;. &lt;/span>&lt;span class="nv">$HOME&lt;/span>&lt;span class="s2">/.asdf/completions/asdf.bash&amp;#34;&lt;/span> &amp;gt;&amp;gt; ~/.bashrc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">source&lt;/span> ~/.bashrc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">asdf plugin-add elixir
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">asdf global elixir 1.14.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">elixir --version
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>创建一个系统用户&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">useradd -r -s /bin/false -m -d /var/lib/akkoma -U akkoma
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>-r&lt;/code>：创建一个系统用户，通常用于运行系统服务而不是登录&lt;/li>
&lt;li>&lt;code>-s /bin/false&lt;/code>：将用户的登录 Shell 设置为 &lt;code>/bin/false&lt;/code>，这意味着该用户无法登录系统&lt;/li>
&lt;li>&lt;code>-m&lt;/code>：在用户的主目录中创建文件夹（如果不存在）&lt;/li>
&lt;li>&lt;code>-d /var/lib/akkoma&lt;/code>：指定用户的主目录为 &lt;code>/var/lib/akkoma&lt;/code>&lt;/li>
&lt;li>&lt;code>-U&lt;/code>：同时创建一个与用户名相同的用户组&lt;/li>
&lt;/ul>
&lt;p>📒Note:&lt;/p>
&lt;p>以 Akkoma 系统用户身份执行单个命令: &lt;code>sudo -Hu akkoma command&lt;/code> 或 &lt;code>sudo -Hu akkoma $SHELL&lt;/code> 切换到该用户的 Shell&lt;/p>
&lt;p>如果没有安装 &lt;code>sudo&lt;/code>，可以使用 &lt;code>su&lt;/code> 命令作为 root 用户（UID 0）执行单个命令，例如 &lt;code>su -l akkoma -s $SHELL -c 'command'&lt;/code>，或使用 &lt;code>su -l akkoma -s $SHELL&lt;/code> 启动一个 Shell&lt;/p>
&lt;p>安装 Akkoma 本体&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">mkdir -p /opt/akkoma
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chown -R akkoma:akkoma /opt/akkoma
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo -Hu akkoma git clone https://akkoma.dev/AkkomaGang/akkoma.git -b stable /opt/akkoma
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>继续安装，询问是否要安装Hex的时候选yes&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo -Hu akkoma mix deps.get
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>创建配置，询问是否安装rebar3选yes&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">sudo -Hu akkoma &lt;span class="nv">MIX_ENV&lt;/span>&lt;span class="o">=&lt;/span>prod mix pleroma.instance gen
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>编译需要较长时间，等待&lt;/p></description></item></channel></rss>
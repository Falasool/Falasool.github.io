<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>ComputerNetwork on Falasool</title><link>https://falasool.github.io/categories/computernetwork/</link><description>Recent content in ComputerNetwork on Falasool</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Thu, 07 Mar 2024 19:13:22 +0800</lastBuildDate><atom:link href="https://falasool.github.io/categories/computernetwork/index.xml" rel="self" type="application/rss+xml"/><item><title>阅读｜《图解HTTP》</title><link>https://falasool.github.io/2024/read-understand-http/</link><pubDate>Thu, 07 Mar 2024 19:13:22 +0800</pubDate><guid>https://falasool.github.io/2024/read-understand-http/</guid><description>
&lt;div class="db-card">
&lt;div class="db-card-subject">
&lt;div class="db-card-post">
&lt;img
loading="lazy"
decoding="async"
referrerpolicy="no-referrer"
src="https://neodb.social/m/book/2021/09/171bc10d5e-6bb7-459d-b762-b6eb2664a8f1.jpg"
/>
&lt;/div>
&lt;div class="db-card-content">
&lt;div class="db-card-title">
&lt;a href="https://neodb.social/book/3BVOzAS5pkNSWDfRT5CMkn" class="cute" target="_blank" rel="noreferrer"
>图解HTTP&lt;/a
>
&lt;/div>
&lt;div class="db-orig_title">
&lt;a href="https://neodb.social/book/3BVOzAS5pkNSWDfRT5CMkn" class="cute" target="_blank" rel="noreferrer"
>HTTPの教科書&lt;/a
>
&lt;/div>
&lt;div class="db-card-author-translator">
[[日] 上野宣]&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 译者：[于均良]
&lt;/div>
&lt;div class="db-card-publish">
出品方：&amp;nbsp;&amp;nbsp;人民邮电出版社
&lt;/div>
&lt;div class="db-card-isbn">ISBN:&amp;nbsp;&amp;nbsp;9787115351531&lt;/div>
&lt;div class="rating">
&lt;span class="allstardark"
>&lt;span
class="allstarlight"
style="width:80%"
>&lt;/span>&lt;/span
>&lt;span class="rating_nums">8&lt;/span>
&lt;/div>
&lt;div class="db-card-abstract">本书对互联网基盘——HTTP协议进行了全面系统的介绍。作者由HTTP协议的发展历史娓娓道来，严谨细致地剖析了HTTP协议的结构，列举诸多常见通信场景及实战案例，最后延伸到Web安全、最新技术动向等方面。本书的特色为在讲解的同时，辅以大量生动形象的通信图例，更好地帮助读者深刻理解HTTP通信过程中客户端与服务器之间的交互情况。读者可通过本书快速了解并掌握HTTP协议的基础，前端工程师分析抓包数据，后...&lt;/div>
&lt;/div>
&lt;div class="db-card-cate">book&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.db-card {
margin: 2.5rem 3rem;
background: var(--card-background);
border-radius: 7px;
box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}
.db-card-subject {
display: flex;
align-items: flex-start;
line-height: 1.6;
padding: 12px;
position: relative;
}
.dark .db-card {
background: var(--card-background);
}
.db-card-content {
flex: 1 1 auto;
}
.db-card-post {
width: 9.6rem;
margin-right: 15px;
display: flex;
flex: 0 0 auto;
}
.db-card-title {
font-size: 14px;
color: var(--card-text-color-main);
}
.db-orig_title,
.db-card-author-translator,
.db-card-publish,
.db-card-isbn {
font-size: 12px;
color: var(--card-text-color-main);
}
.db-card-isbn {
margin-bottom: 10px;
}
.db-card-title a {
text-decoration: none !important;
}
.db-card-abstract,
.db-card-comment {
font-size: 10px;
overflow: scroll;
max-height: 10rem;
color: var(--card-text-color-main);
}
.db-card-cate {
position: absolute;
top: 0;
right: 0;
background: #f99b01;
padding: 1px 8px;
font-size: small;
font-style: italic;
border-radius: 0 8px 0 8px;
text-transform: capitalize;
}
.db-card-post img {
width: 9.6rem !important;
border-radius: 4px;
-o-object-fit: cover;
object-fit: cover;
}
.rating {
margin: 0 0 5px;
font-size: 13px;
line-height: 1;
display: flex;
align-items: center;
}
.rating .allstardark {
position: relative;
color: #f99b01;
height: 16px;
width: 80px;
background-size: auto 100%;
margin-right: 8px;
background-repeat: repeat;
background-image: url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxwYXRoIGQ9Ik05MDguMSAzNTMuMWwtMjUzLjktMzYuOUw1NDAuNyA4Ni4xYy0zLjEtNi4zLTguMi0xMS40LTE0LjUtMTQuNS0xNS44LTcuOC0zNS0xLjMtNDIuOSAxNC41TDM2OS44IDMxNi4ybC0yNTMuOSAzNi45Yy03IDEtMTMuNCA0LjMtMTguMyA5LjMtMTIuMyAxMi43LTEyLjEgMzIuOS42IDQ1LjNsMTgzLjcgMTc5LjEtNDMuNCAyNTIuOWMtMS4yIDYuOS0uMSAxNC4xIDMuMiAyMC4zIDguMiAxNS42IDI3LjYgMjEuNyA0My4yIDEzLjRMNTEyIDc1NGwyMjcuMSAxMTkuNGM2LjIgMy4zIDEzLjQgNC40IDIwLjMgMy4yIDE3LjQtMyAyOS4xLTE5LjUgMjYuMS0zNi45bC00My40LTI1Mi45IDE4My43LTE3OS4xYzUtNC45IDguMy0xMS4zIDkuMy0xOC4zIDIuNy0xNy41LTkuNS0zMy43LTI3LTM2LjN6TTY2NC44IDU2MS42bDM2LjEgMjEwLjNMNTEyIDY3Mi43IDMyMy4xIDc3MmwzNi4xLTIxMC4zLTE1Mi44LTE0OUw0MTcuNiAzODIgNTEyIDE5MC43IDYwNi40IDM4MmwyMTEuMiAzMC43LTE1Mi44IDE0OC45eiIgZmlsbD0iI2Y5OWIwMSIvPjwvc3ZnPg==);
}
.rating .allstarlight {
position: absolute;
left: 0;
color: #f99b01;
height: 16px;
overflow: hidden;
background-size: auto 100%;
background-repeat: repeat;
background-image: url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxwYXRoIGQ9Ik05MDguMSAzNTMuMWwtMjUzLjktMzYuOUw1NDAuNyA4Ni4xYy0zLjEtNi4zLTguMi0xMS40LTE0LjUtMTQuNS0xNS44LTcuOC0zNS0xLjMtNDIuOSAxNC41TDM2OS44IDMxNi4ybC0yNTMuOSAzNi45Yy03IDEtMTMuNCA0LjMtMTguMyA5LjMtMTIuMyAxMi43LTEyLjEgMzIuOS42IDQ1LjNsMTgzLjcgMTc5LjEtNDMuNCAyNTIuOWMtMS4yIDYuOS0uMSAxNC4xIDMuMiAyMC4zIDguMiAxNS42IDI3LjYgMjEuNyA0My4yIDEzLjRMNTEyIDc1NGwyMjcuMSAxMTkuNGM2LjIgMy4zIDEzLjQgNC40IDIwLjMgMy4yIDE3LjQtMyAyOS4xLTE5LjUgMjYuMS0zNi45bC00My40LTI1Mi45IDE4My43LTE3OS4xYzUtNC45IDguMy0xMS4zIDkuMy0xOC4zIDIuNy0xNy41LTkuNS0zMy43LTI3LTM2LjN6IiBmaWxsPSIjZjk5YjAxIi8+PC9zdmc+);
}
@media (max-width: 550px) {
.db-card {
margin: 0.8rem 1rem;
}
.db-card-comment {
display: none;
}
.db-card-cate {
font-size: 10px;
}
}
&lt;/style>
&lt;p>阅读笔记，讲得比较浅，结构有点散，但还是收获了一些&lt;/p>
&lt;h2 id="http-协议">HTTP 协议&lt;/h2>
&lt;p>用于服务端和客户端之间的通信&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 请求报文：
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 请求方法 + uri + 协议版本 + [请求首部字段] + 内容实体
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 请求头 + 请求行 + 请求体，每一部分用换行符区分
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">GET&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="nx">index&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">htm&lt;/span> &lt;span class="nx">HTTP&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Host&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">hackr&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">ip&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>HTTP 是一种无状态 stateless 协议，状态交给 cookie etc.&lt;/li>
&lt;/ul>
&lt;h3 id="cookie">Cookie&lt;/h3>
&lt;p>使用 cookie 进行状态管理，通过在请求、响应报文中添加 cookie 信息控制客户端的状态&lt;/p>
&lt;ul>
&lt;li>cookie 产生于服务端，包含在发送给客户端的 header 里的 set-cookie 字段&lt;/li>
&lt;li>客户端根据 set-cookie 保存一段纯文本信息&lt;/li>
&lt;li>再次向服务端发请求时，请求报文会带上这个cookicookie&lt;/li>
&lt;li>服务端接收到 cookie 和服务端记录对比，得到之前的状态信息&lt;/li>
&lt;/ul>
&lt;p>为 Cookie 服务的头部字段见 [[HTTP#Cookie 相关字段]]&lt;/p>
&lt;p>用 Cookie 管理 Session（会话）&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Set&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">Cookie&lt;/span>&lt;span class="o">:&amp;lt;&lt;/span>&lt;span class="nx">Session&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">ID&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="ajax">Ajax&lt;/h3>
&lt;p>解决 HTTP 的缺点：&lt;/p>
&lt;ul>
&lt;li>1 条链接上只能发一个请求&lt;/li>
&lt;li>头部未经压缩就发送，头部信息越多延迟越大&lt;/li>
&lt;li>请求只能从客户端开始，客户端不能接收响应以外的指令&lt;/li>
&lt;/ul>
&lt;p>核心 API：&lt;code>XMLHttpRequest&lt;/code> 实现无刷新局部更新&lt;/p>
&lt;h3 id="http-头部">HTTP 头部&lt;/h3>
&lt;h4 id="通用头部字段">通用头部字段&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Cache&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">control&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="kr">private&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nx">max&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">age&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="nx">no&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">cache&lt;/span> &lt;span class="c1">// 控制缓存
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">Collection&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">close&lt;/span> &lt;span class="c1">// 断开连接
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">...&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="请求头部字段">请求头部字段&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">User&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">Agent&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">Mozilla&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">5.0&lt;/span> &lt;span class="c1">// 将创建请求的浏览器和用户代理名称等信息发给服务端，写爬虫用
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">Accept&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">text&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nx">html&lt;/span> &lt;span class="c1">// 通知服务端，用户代理能处理的数据类型/格式和q权重
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">Authorization&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">Basic&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">dWufaslngafaJFljfsl&lt;/span>&lt;span class="o">==&lt;/span> &lt;span class="c1">// 通知服务端，用户代理的认证信息
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// If-xxx 条件请求
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">If&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">Modified&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">Since&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">Thu&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">15&lt;/span> &lt;span class="nx">Apr&lt;/span> &lt;span class="mi">2004&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="mi">00&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mi">00&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mi">00&lt;/span> &lt;span class="nx">GMT&lt;/span> &lt;span class="c1">// 如果在指定日期之后，资源发生了更新，服务端才会接受请求，用于确认本地资源的有效性
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">Range&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">bytes&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">5000&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">10000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">...&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="响应头部字段">响应头部字段&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Age&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mi">600&lt;/span> &lt;span class="c1">// 源服务器600s前创建了响应
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">Server&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">Apache&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">2.2&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="mi">17&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">Unix&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 当前服务器上HTTP服务器的信息
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="实体头部字段">实体头部字段&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Content&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">Language&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">zh&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">CN&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Content&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">Length&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mi">15000&lt;/span> &lt;span class="c1">// 实体主体的大小（字节）
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">Content&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">Type&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nx">text&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nx">html&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="nx">charset&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nx">UTF&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="c1">// 实体主体内对象的媒体类型
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="cookie-相关字段">Cookie 相关字段&lt;/h5>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Set&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">Cookie&lt;/span> &lt;span class="c1">// 响应头部字段
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">Cookie&lt;/span> &lt;span class="c1">// 请求头部字段
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="其他头部字段">其他头部字段&lt;/h4>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">X&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">Frame&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">Options&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">X&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">XSS&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="nx">Protection&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="http11-中的-7-种方法">HTTP/1.1 中的 7 种方法&lt;/h3>
&lt;h4 id="get">GET&lt;/h4>
&lt;p>请求资源&lt;/p>
&lt;h4 id="post">POST&lt;/h4>
&lt;p>发送实体的主体 entity body&lt;/p>
&lt;h4 id="put">PUT&lt;/h4>
&lt;p>传输文件，类似 POST，但是没有验证机制，几乎不使用&lt;/p>
&lt;h4 id="head">HEAD&lt;/h4>
&lt;p>获取报文首部，和 GET 一样，只是不返回报文主体部分&lt;/p>
&lt;h4 id="delete">DELETE&lt;/h4>
&lt;p>删除文件，和 PUT 相反，同样的原因不推荐使用&lt;/p>
&lt;h4 id="options">OPTIONS&lt;/h4>
&lt;p>查询资源支持什么方法&lt;/p>
&lt;ul>
&lt;li>INVITE&lt;/li>
&lt;li>ACK&lt;/li>
&lt;li>CANCEL&lt;/li>
&lt;li>&amp;hellip;&lt;/li>
&lt;/ul>
&lt;h4 id="trace">TRACE&lt;/h4>
&lt;p>服务端把接收到的请求报文再还给客户端，这样可以检查请求有没有/怎么样被加工篡改的&lt;/p>
&lt;h4 id="connect">CONNECT&lt;/h4>
&lt;h3 id="http-报文">HTTP 报文&lt;/h3>
&lt;p>是多行数据构成的字符串文本&lt;/p>
&lt;ul>
&lt;li>报文message&lt;/li>
&lt;li>实体 entity&lt;/li>
&lt;/ul>
&lt;h4 id="请求报文">请求报文&lt;/h4>
&lt;h4 id="响应报文">响应报文&lt;/h4>
&lt;h4 id="多部分对象集合-multipart">多部分对象集合 Multipart&lt;/h4>
&lt;p>包含图片、文本、视频等多个不同类型的数据&lt;/p>
&lt;p>multipart/form-data：上传 web 表单文件
multipart/byteranges：范围请求，允许服务端只发送 HTTP 消息的一部分到客户端；传输大媒体文件、断点续传时很有用&lt;/p>
&lt;h3 id="断点续传获取部分内容的范围请求-range-request">断点续传（获取部分内容的范围请求 Range Request）&lt;/h3>
&lt;ul>
&lt;li>用首部字段 Range 指定资源的 byte 范围&lt;/li>
&lt;li>范围请求的对应状态码为 206，如果服务端无法响应范围请求，会返回 200 和完整的实体内容&lt;/li>
&lt;/ul>
&lt;p>例如：有一份 10000 字节的资源&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="nx">GET&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="nx">tip&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">jpg&lt;/span> &lt;span class="nx">HTTP&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="mf">1.1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">Host&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">www&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">usagidesign&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">jp&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 返回5001-10000的部分
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">Range&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">bytes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">5001&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">10000&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 返回5001之后的全部
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">Range&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">bytes&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">5001&lt;/span>&lt;span class="o">-&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="内容协商-content-negotiationi8n">内容协商 content negotiation==i8n&lt;/h3>
&lt;p>根据浏览器的默认语言（en），返回一个 uri 的 en 页面&lt;/p>
&lt;p>依据是请求报文中的一些首部字段：&lt;/p>
&lt;ul>
&lt;li>Accept&lt;/li>
&lt;li>Accept-Charset&lt;/li>
&lt;li>Accept-Encoding&lt;/li>
&lt;li>Accept-Language&lt;/li>
&lt;li>Content-Language&lt;/li>
&lt;/ul>
&lt;p>内容协商可以由服务端或客户端完成&lt;/p>
&lt;h3 id="http状态码">HTTP状态码&lt;/h3>
&lt;p>1-信息类
2-成功
3-重定向
4-客户端错误
5-服务端错误&lt;/p>
&lt;h3 id="web-服务器">Web 服务器&lt;/h3>
&lt;p>静态 web 服务器Nginx&lt;/p>
&lt;h3 id="数据转发">数据转发&lt;/h3>
&lt;ul>
&lt;li>代理
&lt;ul>
&lt;li>缓存代理 CDN&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>网关：网关是一个概念，是协议转换器（把 HTTP 转换为其他协议）&lt;/li>
&lt;li>隧道&lt;/li>
&lt;/ul>
&lt;h2 id="https">HTTPS&lt;/h2>
&lt;p>http 的缺点：&lt;/p>
&lt;ul>
&lt;li>明文传输&lt;/li>
&lt;li>不验证通信方的身份&lt;/li>
&lt;li>无法保证完整性（中间人攻击）&lt;/li>
&lt;/ul>
&lt;h2 id="tcp">TCP&lt;/h2>
&lt;p>提供字节流服务（分割数据包）&lt;/p>
&lt;h3 id="three-way-handshaking">three-way handshaking&lt;/h3>
&lt;p>TCP 的标志 flag：SYN、ACK&lt;/p>
&lt;ul>
&lt;li>SYN 是发送端生成的（请求同步）&lt;/li>
&lt;li>ACK 是接收端生成的（确认同步）&lt;/li>
&lt;/ul>
&lt;p>第一次握手：发送端发送请求（syn=j）
第二次握手：接收端返回 SYN、ACK 标志，告诉对方发送功能正常，自己的接收功能正常
第三次握手：发送端告诉接收端，你的收发功能都正常（响应能力），可以开始通信了&lt;/p>
&lt;ul>
&lt;li>SYN blood 攻击：接到第 2 次握手后不回应第 3 次握手，服务器会发送 5 次请求然后丢弃请求。解决方法：cookie 记录恶意 ip、缩短服务器的等待时间&lt;/li>
&lt;/ul>
&lt;p>为什么不 2 次握手：如果是 2 次握手，客户端发送一次请求后网络中断，一段时间后这个废弃的请求到达服务器，服务器就会正常响应，建立一个无效的链接，增加了网络开销&lt;/p>
&lt;h2 id="dns">DNS&lt;/h2>
&lt;p>应用层，把域名解析到 IP（联想：ARP）&lt;/p>
&lt;h2 id="uriurl">URI/URL&lt;/h2>
&lt;p>URL 是 URI 的子集，url 一定是 uri，比如网址画 url 就是 uri，同时邮件地址、电话号码也是 uri&lt;/p>
&lt;h2 id="用户身份认证">用户身份认证&lt;/h2>
&lt;p>认证方式：&lt;/p>
&lt;ul>
&lt;li>BASIC（401）&lt;/li>
&lt;li>DIGEST&lt;/li>
&lt;li>SSL 客户端&lt;/li>
&lt;li>FormBase&lt;/li>
&lt;/ul></description></item><item><title>网络通信过程 + Vmess搭建</title><link>https://falasool.github.io/2023/about-dns-principle-and-vpn/</link><pubDate>Mon, 17 Jul 2023 21:31:10 +0800</pubDate><guid>https://falasool.github.io/2023/about-dns-principle-and-vpn/</guid><description>&lt;h2 id="网络通信的基本过程">网络通信的基本过程&lt;/h2>
&lt;blockquote>
&lt;p>设计出层级结构。出去时不断加码，加信息，加标签，到达时，不断解码，减信息，解包&lt;/p>
&lt;/blockquote>
&lt;h3 id="dns-解析">DNS 解析&lt;/h3>
&lt;p>输入域名/ip &amp;ndash; 检查浏览器/本地缓存，hosts 文件 &amp;ndash; 发请求到电脑的 DNS 服务器（OSI 七层/五层模型） &amp;ndash; DNS 是应用层的协议，用于请求域名/ip，请求一层一层下传，到物理层（网卡接口）&amp;ndash; 请求到的数据给传输层 &amp;ndash; 传输层封装应用层的数据（源端口、目标端口）为数据包 &amp;ndash; 下传 &amp;ndash; 网络层、同样封装（源 ip、目标 ip）&amp;ndash; 当电脑找不到这个 ip（不在范围内）会发请求给网关（路由器）&lt;/p>
&lt;p>数据顺着物理层到网卡接口 - 网线发出到交换机（二层设备） &amp;ndash; 转发到路由器（三层设备），接收数据包，传到网络层 &amp;ndash; 因为目标 ip 不在局域网内，所以会转发出去（公网的其他路由器）&amp;ndash; 把内网网段 NAT 映射为能在公网传输的 ip - 发送数据包到 DNS 服务器（默认端口 53），DNS 服务器根据 OSI 层层解析直到应用层，拿到请求的数据（ip），开始回传&lt;/p>
&lt;p>传输层（+端口） &amp;ndash; 网络层（+ip） &amp;ndash; 数据链路层（+MAC 地址）&amp;ndash; 从物理网口出去 &amp;ndash;互联网 &amp;ndash; 到正确的路由器，路由器转换 IP、MAC、添加头部 &amp;ndash; 反向重复一遍发出请求的步骤，让电脑收到目标网站的 ip&lt;/p>
&lt;p>OSI 七层模型&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>层&lt;/th>
&lt;th>层&lt;/th>
&lt;th>detail&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>应用层&lt;/td>
&lt;td>应用层&lt;/td>
&lt;td>HTTP、FTP&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>表示层&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>会话层&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>传输层&lt;/td>
&lt;td>传输层（端口）&lt;/td>
&lt;td>TCP、UDP&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>网络层&lt;/td>
&lt;td>网络层&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>网络接口层&lt;/td>
&lt;td>数据链接层&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;/td>
&lt;td>物理层&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="gfw-工作原理">GFW 工作原理&lt;/h2>
&lt;p>底层原因：能看到我们的数据内容&lt;/p>
&lt;h3 id="dns-污染劫持">DNS 污染/劫持&lt;/h3>
&lt;p>访问 Google，先检查本机有无缓存 Google 的 ip，查看 hosts 文件里有没有对 google.com 添加 IP 域名映射关系，都没有 ➡️ 向本机配置的 DNS 服务器发 DNS 请求，请求 Google 的 ip，这个请求的数据包来到 GFW（五层设备）时会被看到内容（假设未被拦截），来到 real internet，到达 DNS 服务器并发回数据包，被 GFW 解包，篡改数据（ip 地址）后发给本机，找不到假 ip 对应的服务器所以访问不了&lt;/p>
&lt;p>解决：&lt;/p>
&lt;p>不发送 DNS 请求，在 host 文件添加域名 IP 映射关系。因为 HTTP 协议是基于 TCP、要先用 TCP 和服务器建立连接才能用 HTTP 访问，所以接下来向服务器发送 TCP 请求 ⬇️&lt;/p>
&lt;h3 id="tcp-重置攻击">TCP 重置攻击&lt;/h3>
&lt;p>这个请求来到 GFW，被解包到网络层发现了目标 ip，在它的黑名单里，它会拒绝或伪造数据（回程阻断，出去的数据包不拦截，服务器返回的包才拦截，这会导致第 2 次握手无法完成，被阻断的服务器会不停的重传，客户端会一直等待超时）&lt;/p>
&lt;h3 id="域名被-ban">域名被 ban&lt;/h3>
&lt;p>谷歌有很多服务器，其中一个没在黑名单上，GFW 放行了。返回的数据包也被放行来到本机。现在开始发数据，来到 GFW，网络层 ip 没问题，应用层发现要 google.com 的数据，google.com 域名在黑名单里，数据包被干掉&lt;/p>
&lt;h3 id="重放攻击">重放攻击&lt;/h3>
&lt;p>防火墙用本机发送的数据包探测目标 VPS，有没有运行特定服务，比如 SS&lt;/p>
&lt;h2 id="对策">对策&lt;/h2>
&lt;p>加密数据：&lt;/p>
&lt;p>传统 vpn 能加密，但是特征太明显&lt;/p>
&lt;p>shadowsocks 协议：vps 上搭建 ss 服务端，监听端口 1111，本机运行 ss 客户端并监听端口 1080，浏览器设置代理端口&lt;/p>
&lt;p>vmess 协议&lt;/p>
&lt;h2 id="搭建-shadowsocks-节点没有实操">搭建 Shadowsocks 节点(没有实操)&lt;/h2>
&lt;p>伪装成 http&lt;/p>
&lt;p>购买 VPS，SSH 连接&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">apt install shadowsocks-libev &lt;span class="c1"># 安装&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl status shadowsocks-libev.service &lt;span class="c1"># 查看状态&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vim /etc/shadowsocks-libev/config.json &lt;span class="c1"># 修改配置文件，ip改为0.0.0.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl restart shadowsocks-libev.service &lt;span class="c1"># 重启&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">journalctl -u shadowsocks-libev.service -f &lt;span class="c1"># 查看日志&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>防火墙设置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">ufw status &lt;span class="c1"># 查看状态&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ufw allow &lt;span class="m">8388&lt;/span> &lt;span class="c1"># 开放端口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ufw deny &lt;span class="m">8388&lt;/span> &lt;span class="c1"># 拒绝端口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ufw delete allow &lt;span class="m">8388&lt;/span> &lt;span class="c1"># 删除规则&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ufw disable &lt;span class="c1"># 关闭防火墙&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ufw &lt;span class="nb">enable&lt;/span> &lt;span class="c1">#启动防火墙&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>最近的心得：防火墙白名单+抗封锁 snap 版 shadowsocks-libev+OutlineVPN 客户端 非常抗揍，真香！（关键 SS 比基于 tls 的如 trojan,v2ray 速度要快）&lt;/p>
&lt;p>我也是看了网上各路文章才有了这思路的，目前用得很好。1、防火墙 100%阻断中间人，因为只有你设置好白名单的 IP 才能连接服务器 。2、抗封锁 snap 最新版（edge 版不是 stable 版）可能在防主动识别部分针对性改动了一下，听说去了重放过滤器。3、outlineVPN 客户端听说可以合并部分流量，以减少被动识别拉清单（玄学）&lt;/p>
&lt;/blockquote>
&lt;p>裸奔的 ss 服务容易被重放攻击探测到，用 plugin 伪装数据流量&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/shadowsocks/v2ray-plugin" target="_blank" rel="noopener"
>https://github.com/shadowsocks/v2ray-plugin&lt;/a>
&lt;span style="white-space: nowrap;">&lt;svg width=".7em" height=".7em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">apt install shadowsocks-v2ray-plugin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dpkg -L
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ss-v2ray-plugin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vim /etc/shadowsocks-libev/config.json
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+ &lt;span class="s2">&amp;#34;plugin&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;ss-v2ray-plugin&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">+ &lt;span class="s2">&amp;#34;plugin_opts&amp;#34;&lt;/span>: &lt;span class="s2">&amp;#34;server&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl restart shadowsocks-libev.service
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="trojan-原理和搭建">Trojan 原理和搭建&lt;/h2>
&lt;p>伪装成 https&lt;/p>
&lt;p>http 的问题：明文、可被篡改&lt;/p>
&lt;p>https: http + tls&lt;/p>
&lt;h3 id="tls">TLS&lt;/h3>
&lt;p>非对称加密：公钥、私钥&lt;/p>
&lt;p>服务器向 CA 机构请求 SSL 证书，CA 机构要求证明域名所有权后颁发证明（包含公钥和有效期），之后才能进行 https 访问&lt;/p>
&lt;p>http 数据交给 tls 进行加密，先要跟网站建立 tls 连接，用对方的公钥加密数据（实际上是握手后协商出对称加密算法的密钥）后发送，服务器用私钥解密&lt;/p>
&lt;blockquote>
&lt;p>所以 tls 协议概括一下就是，客户端和服务端使用非对称加密算法协商出对称加密算法的主密钥（使用非对称加密算法保护主密钥不被中间人窃取），然后切换到使用对称加密算法（使用对应的主密钥）进行双向通讯。&lt;/p>
&lt;/blockquote>
&lt;h3 id="trojan">Trojan&lt;/h3>
&lt;p>不耐烦了，直奔主题，下次再来！&lt;/p>
&lt;p>&lt;a class="link" href="https://www.youtube.com/watch?v=gw2Vl1h89Wo&amp;amp;list=PL5TbbtexT8T3d_7UX2aSFhoMYk-cl4kf4&amp;amp;index=4" target="_blank" rel="noopener"
>https://www.youtube.com/watch?v=gw2Vl1h89Wo&amp;list=PL5TbbtexT8T3d_7UX2aSFhoMYk-cl4kf4&amp;index=4&lt;/a>
&lt;span style="white-space: nowrap;">&lt;svg width=".7em" height=".7em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/p>
&lt;h2 id="vmess--tcp-tls">Vmess + TCP +TLS&lt;/h2>
&lt;h3 id="服务器端">服务器端&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!!!重要！x-ui不要把xray版本升级到1.7.5以上，否则无法搭建vless节点！
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>&lt;span class="c1">#更新软件源&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apt update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#启用 BBR TCP 拥塞控制算法&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;net.core.default_qdisc=fq&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;net.ipv4.tcp_congestion_control=bbr&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sysctl -p
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#安装x-ui：&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">bash &amp;lt;&lt;span class="o">(&lt;/span>curl -Ls https://raw.githubusercontent.com/vaxilu/x-ui/master/install.sh&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>(安装 Nginx、申请 SSL 证书)&lt;/p>
&lt;blockquote>
&lt;p>http 站点优先，个人网盘符合单节点大流量特征&lt;/p>
&lt;/blockquote>
&lt;p>在浏览器搜索 &lt;code>intext:登录 Cloudreve&lt;/code>，找到一个可访问的网站作为伪装站&lt;/p>
&lt;p>配置 Nginx&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 创建配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">touch /etc/nginx/sites-available/vmess.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 进入修改&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">vim /etc/nginx/sites-available/vmess.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>配置文件内容&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl"> server &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen &lt;span class="m">443&lt;/span> ssl&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server_name joy.ponderduck.cc&lt;span class="p">;&lt;/span> &lt;span class="c1">#你的域名&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_certificate /etc/letsencrypt/live/ponderduck.cc/fullchain.pem&lt;span class="p">;&lt;/span> &lt;span class="c1">#证书位置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_certificate_key /etc/letsencrypt/live/ponderduck.cc/privkey.pem&lt;span class="p">;&lt;/span> &lt;span class="c1">#私钥位置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_session_timeout 1d&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_session_cache shared:MozSSL:10m&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_session_tickets off&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_protocols TLSv1.2 TLSv1.3&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ssl_prefer_server_ciphers off&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location / &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_pass http://pan.qdovo.com/&lt;span class="p">;&lt;/span> &lt;span class="c1">#伪装网址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_redirect off&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_ssl_server_name on&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sub_filter_once off&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sub_filter &lt;span class="s2">&amp;#34;pan.qdovo.com&amp;#34;&lt;/span> &lt;span class="nv">$server_name&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Host &lt;span class="s2">&amp;#34;pan.qdovo.com&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Referer &lt;span class="nv">$http_referer&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Real-IP &lt;span class="nv">$remote_addr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header User-Agent &lt;span class="nv">$http_user_agent&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Forwarded-For &lt;span class="nv">$proxy_add_x_forwarded_for&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Forwarded-Proto https&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Accept-Encoding &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Accept-Language &lt;span class="s2">&amp;#34;zh-CN&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location /ray &lt;span class="o">{&lt;/span> &lt;span class="c1">#分流路径&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_redirect off&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_pass http://127.0.0.1:10000&lt;span class="p">;&lt;/span> &lt;span class="c1">#Xray端口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_http_version 1.1&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Upgrade &lt;span class="nv">$http_upgrade&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Connection &lt;span class="s2">&amp;#34;upgrade&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Host &lt;span class="nv">$host&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Real-IP &lt;span class="nv">$remote_addr&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Forwarded-For &lt;span class="nv">$proxy_add_x_forwarded_for&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location /xui &lt;span class="o">{&lt;/span> &lt;span class="c1">#xui路径&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_redirect off&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_pass http://127.0.0.1:9999&lt;span class="p">;&lt;/span> &lt;span class="c1">#xui监听端口&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_http_version 1.1&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Host &lt;span class="nv">$host&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> server &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> listen 80&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location /.well-known/ &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> root /var/www/html&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> location / &lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> rewrite ^&lt;span class="o">(&lt;/span>.*&lt;span class="o">)&lt;/span>$ https://&lt;span class="nv">$host$1&lt;/span> permanent&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>测试、建立软链接、重启&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">nginx -t
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ln -s /etc/nginx/sites-available/vmess.conf /etc/nginx/sites-enabled/vmess.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">systemctl start nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># or&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx -s reload
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="trojan-go">Trojan-Go&lt;/h2>
&lt;p>一键部署 Trojan-Go&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">bash &amp;lt;&lt;span class="o">(&lt;/span>curl -sSL &lt;span class="s2">&amp;#34;https://raw.githubusercontent.com/veip007/hj/main/trojan-go.sh&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="参考--致谢">参考 &amp;amp; 致谢&lt;/h2>
&lt;p>&lt;a class="link" href="https://v2xtls.org/clashx%E9%85%8D%E7%BD%AEv2ray%E6%95%99%E7%A8%8B/" target="_blank" rel="noopener"
>ClashX 配置 V2ray 教程&lt;/a>
&lt;span style="white-space: nowrap;">&lt;svg width=".7em" height=".7em" viewBox="0 0 21 21"
xmlns="http://www.w3.org/2000/svg">
&lt;path d="m13 3l3.293 3.293l-7 7l1.414 1.414l7-7L21 11V3z" fill="currentColor" />
&lt;path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"
fill="currentColor">
&lt;/svg>&lt;/span>
&lt;/p>
&lt;p>[编译、配置 nginx,使 V2ray,Xray,Trojan,博客网站等共用 443 端口](&lt;/p></description></item></channel></rss>
<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Misskey å®ä¾‹æ­å»ºæ•™ç¨‹ - Falasool</title><link rel=icon type=image/png href=static/img/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="åè®°å½•å‘ï¼Œæ‰€ä»¥æœ‰çš„åœ°æ–¹å¾ˆå•°å—¦ï¼Œæœ‰çš„åœ°æ–¹åƒå‘ç™«çš„é’è›™è¿å‡»è·å¶æ²¡æœ‰ç•™ä¸‹ä»»ä½•ç—•è¿¹"><meta property="og:image" content><meta property="og:title" content="Misskey å®ä¾‹æ­å»ºæ•™ç¨‹"><meta property="og:description" content="åè®°å½•å‘ï¼Œæ‰€ä»¥æœ‰çš„åœ°æ–¹å¾ˆå•°å—¦ï¼Œæœ‰çš„åœ°æ–¹åƒå‘ç™«çš„é’è›™è¿å‡»è·å¶æ²¡æœ‰ç•™ä¸‹ä»»ä½•ç—•è¿¹"><meta property="og:type" content="article"><meta property="og:url" content="https://falasool.github.io/posts/misskey/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-19T20:19:15+08:00"><meta property="article:modified_time" content="2022-11-19T20:19:15+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Misskey å®ä¾‹æ­å»ºæ•™ç¨‹"><meta name=twitter:description content="åè®°å½•å‘ï¼Œæ‰€ä»¥æœ‰çš„åœ°æ–¹å¾ˆå•°å—¦ï¼Œæœ‰çš„åœ°æ–¹åƒå‘ç™«çš„é’è›™è¿å‡»è·å¶æ²¡æœ‰ç•™ä¸‹ä»»ä½•ç—•è¿¹"><script src=https://falasool.github.io/js/feather.min.js></script>
<link href=https://falasool.github.io/css/fonts.4bacf4386d3f58fdc378d205a903311c80158bf414d25698589b658e0273156d.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://falasool.github.io/css/main.409b4163748cd4906669e4c6d5a0483433fd78fba4753a71f4d1748dbc962736.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://falasool.github.io/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css media="(prefers-color-scheme: dark)"></head><body><div class=content><header><div class=main><a href=https://falasool.github.io/>Falasool</a></div><nav><a href=/friends/></a>
<a href=/about>About</a>
<a href=/friends>Friends</a>
<a href=/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>Misskey å®ä¾‹æ­å»ºæ•™ç¨‹</h1><div class=meta>Posted on Nov 19, 2022</div></div><section class=body><p>æœ¬æ¬¡æ­å»ºä½¿ç”¨ Ubuntu 22.10 ç³»ç»Ÿ</p><h2 id=è´­ä¹°-vps>è´­ä¹° VPS</h2><p>âš ï¸ ä¸è¦ä¹°æœºæˆ¿åœ¨å¤§é™†çš„æœåŠ¡å•† VPS âš ï¸</p><p>åœ¨å¤‡æ¡ˆé€šè¿‡ä¹‹å‰ 80 å’Œ 443 ç«¯å£æ˜¯å°ç¦çš„ -> æ— æ³•ç”³è¯· SSL è¯ä¹¦ -> Misskey éœ€è¦ SSL æ‰èƒ½è®¿é—®ï¼ŒGG</p><p>ï¼ˆå³ä½¿æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œä¹°å¤§é™†èŠ‚ç‚¹çš„æœåŠ¡å»ºç«™ä¹Ÿæ˜¯ä¸€ç§è‡ªæ€è¡Œä¸ºï¼‰</p><h3 id=æ³¨å†Œ>æ³¨å†Œ</h3><p>æ³¨å†Œ Vultr è´¦å·ï¼Œå……å€¼</p><p><img src=https://cdn.jsdelivr.net/gh/Falasool/blog-pic-bed/blog/misskey1.png alt=image-20221120012614543></p><h3 id=åˆ›å»º-vps>åˆ›å»º VPS</h3><p><img src=https://cdn.jsdelivr.net/gh/Falasool/blog-pic-bed/blog/image-20221120012203832.png alt=image-20221120012203832></p><ul><li><p>é€‰ Cloud Compute</p></li><li><p>CPU é€‰ AMD å’Œ Intel éƒ½è¡Œ</p></li><li><p>æœºæˆ¿ä½ç½®é€‰æ‹©æ—¥æœ¬ã€æ–°åŠ å¡ã€ç¾è¥¿éƒ½è¡Œï¼Œä¸€èˆ¬ä¸æ¨èæ¬§æ´²ï¼ˆå¯¹äºä¸­å›½å›½å†…ï¼‰</p></li><li><p>é€‰æ‹©æ“ä½œç³»ç»Ÿï¼šUbuntu 22.10 x64</p></li><li><p>é€‰æ‹© Sizeï¼š$5 çš„ 1C1G1TB å¥—é¤ï¼ˆè®°å¾—å‹¾é€‰ No Thanksï¼‰</p></li><li><p>å…³é—­è‡ªåŠ¨å¤‡ä»½ï¼Œçœ $1</p></li><li><p>Additional Featuresï¼šå‹¾é€‰ Enable IPv6</p></li><li><p>æ·»åŠ  SSH Keys</p></li></ul><p>æ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-keygen -t rsa -b <span style=color:#ae81ff>4096</span> -C <span style=color:#e6db74>&#34;Example comment&#34;</span>
</span></span></code></pre></div><p>åœ¨è¿™è¡Œæç¤ºåé¢è¾“å…¥ä½ æƒ³è¦ä¿å­˜å¯†é’¥çš„è·¯å¾„</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-text data-lang=text><span style=display:flex><span>Generating public/private rsa key pair.
</span></span><span style=display:flex><span>Enter file in which to save the key (/home/example_user/.ssh/id_rsa):
</span></span></code></pre></div><p>æˆ‘è¾“å…¥ï¼ˆuu æ˜¯æˆ‘çš„ç”µè„‘ç”¨æˆ·åï¼‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>/home/uu/.ssh/id_rsa_vultr
</span></span></code></pre></div><p>æ‰€ä»¥åœ¨ <code>/.ssh</code> ç›®å½•ä¸‹å¯ä»¥æ‰¾åˆ° <code>id_rsa_vultr</code> å’Œ <code>id_rsa_vultr.pub</code> æ–‡ä»¶ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ç§é’¥å’Œå…¬é’¥</p><p>æ¥ä¸‹æ¥è¦æŠŠå…¬é’¥å†…å®¹æ·»åŠ åˆ° vultr å»</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># è¿›å…¥.ssh ç›®å½•</span>
</span></span><span style=display:flex><span>cd .ssh
</span></span><span style=display:flex><span><span style=color:#75715e># æ‰“å°æ–‡ä»¶å†…å®¹</span>
</span></span><span style=display:flex><span>cat id_rsa_vultr.pub
</span></span></code></pre></div><ul><li>è¿™æ—¶åº•éƒ¨ä»˜æ¬¾æ åº”è¯¥æ˜¾ç¤º <code>$5.00/month</code> ï¼Œç‚¹å‡» <code>Deploy Now</code> ç¡®è®¤åˆ›å»ºæœåŠ¡å™¨ï¼Œç­‰å¾…ä¸€ä¼šï¼Œç­‰ Status å˜æˆ Running å°±å¥½äº†</li></ul><p><img src=https://cdn.jsdelivr.net/gh/Falasool/blog-pic-bed/blog/misskey2-1.png alt=image-20221120012909994></p><p>ç‚¹å‡»åˆšåˆšåˆ›å»ºçš„ VPSï¼Œçœ‹åˆ°å¦‚ä¸‹ç•Œé¢ã€‚</p><p>å·¦ä¸‹è§’çš„ IP Addressã€Usernameã€Password æ˜¯å¾…ä¼šè¿æ¥æœåŠ¡å™¨çš„æ—¶å€™ï¼Œè¦ç”¨åˆ°çš„ SSH è¿æ¥ä¿¡æ¯</p><p><img src=https://cdn.jsdelivr.net/gh/Falasool/blog-pic-bed/blog/misskey3.png alt=image-20221120013010174></p><ol><li>ç™»å½• VNCï¼šæŸ¥çœ‹æ§åˆ¶å°</li><li>å…³æœºï¼šå°±å’Œå…³ç”µè„‘ä¸€æ ·ï¼ˆå…³æœºçš„æ—¶å€™ä»ç„¶åœ¨è®¡è´¹å“¦ï¼ï¼‰</li><li>é‡å¯ï¼šå°±å’Œé‡å¯ç”µè„‘ä¸€æ ·</li><li>é‡è£…ç³»ç»Ÿï¼šæŠŠæœåŠ¡å™¨é‡ç½®æˆåˆšåˆ›å»ºæ—¶çš„çŠ¶æ€</li><li>é”€æ¯/åˆ é™¤ï¼šé”€æ¯äº†æœåŠ¡å™¨å°±ä¸è®¡è´¹äº†ï¼Œæ•°æ®ä¸¢å¤±ï¼Œæ— æ³•æ‰¾å›</li></ol><p>Snapshotsï¼šå¿«ç…§ï¼ŒæŒ‡å°†å½“å‰ VPS çš„çŠ¶æ€ä¿å­˜ä¸‹æ¥ï¼Œå¯¹ VPS è¿›è¡Œå®Œæ•´å¤‡ä»½</p><p>æœåŠ¡å™¨åˆ›å»ºå®Œæˆ</p><h3 id=æ£€æŸ¥-ip>æ£€æŸ¥ IP</h3><p>Ping ä¸€ä¸‹ IP</p><p><img src=https://cdn.jsdelivr.net/gh/Falasool/blog-pic-bed/blog/misskey4.png alt=image-20221120013147886></p><p>ç”¨æ£€æŸ¥å·¥å…·æ¯”å¦‚ <a href=https://ip112.cn/>https://ip112.cn/</a> æ£€æŸ¥ IPï¼Œæ­¤ IP å¯ç”¨</p><p><img src=https://cdn.jsdelivr.net/gh/Falasool/blog-pic-bed/blog/misskey5.png alt=image-20221120013305544></p><p>å…¶å®ƒæµ‹è¯•å·¥å…·</p><ul><li><a href=http://ping.pe/>http://ping.pe/</a> â€” å…¨çƒèŠ‚ç‚¹ Pingï¼ŒåŒ…æ‹¬ä¸­å›½çš„ä¸‰å¤§è¿è¥å•†</li><li><a href=http://ping.chinaz.com/>http://ping.chinaz.com/</a> â€” Ping æ£€æµ‹ä¸­å›½å¤§é™†çš„è®¿é—®æƒ…å†µ</li></ul><h2 id=åŸŸå>åŸŸå</h2><p>åœ¨åŸŸåå•† <a href=https://www.dynadot.com/zh/>Dynadot</a> æ³¨å†Œè´¦å·ï¼Œä¹°ä¸€ä¸ªåŸŸå</p><h3 id=è§£æåŸŸå>è§£æåŸŸå</h3><p>ä¾æ¬¡ç‚¹å‡»</p><p><img src=https://raw.githubusercontent.com/Falasool/blog-pic-bed/main/blog/misskey6.png alt=image-20221120013439245></p><p>æš‚åœ â¸ï¸</p><p>å» <a href=https://dash.cloudflare.com/>CloudFlare</a> æ³¨å†Œç™»å½•è´¦å·ï¼Œä¾æ¬¡æ“ä½œï¼š</p><p>æ·»åŠ æ–°ç«™ç‚¹</p><p><img src=https://raw.githubusercontent.com/Falasool/blog-pic-bed/main/blog/misskey7.png alt=image-20221120013614146></p><p>è¾“å…¥ä½ çš„åŸŸå</p><p><img src=https://raw.githubusercontent.com/Falasool/blog-pic-bed/main/blog/misskey8.png alt=image-20221120013635155></p><p>é€‰æ‹©å…è´¹æ–¹æ¡ˆ</p><p>æ·»åŠ  DNS è§£æè®°å½•</p><ul><li><p><code>*</code> æ˜¯é€šé…ç¬¦ï¼Œæ„æ€æ˜¯æˆ‘çš„äºŒçº§åŸŸåï¼Œxxx.ponderduck.cc çš„ DNS è§£æä¹Ÿä¸€èµ·è¢«æ¥ç®¡äº†ã€‚ä¸ç”¨æˆ‘ä¸€ä¸ªä¸€ä¸ªè®¾ç½®</p></li><li><p>ç¬¬äºŒè¡Œæ˜¯åŸŸåæœ¬ä½“</p></li><li><p><code>www</code> è®©è¾“å…¥ <a href=https://www.ponderduck.cc>www.ponderduck.cc</a> ä¹Ÿèƒ½è®¿é—®</p></li></ul><p>å¤åˆ¶ CloudFlare æä¾›çš„ä¸¤ä¸ªåç§°æœåŠ¡å™¨ï¼Œå¡«è¿› Dynadot çš„ DNS è®¾ç½®ï¼Œä¿å­˜</p><p>å›åˆ° CloudFlare ç‚¹å‡» <code>Done, check nameservers</code>ï¼Œç­‰ä¸€ä¼š</p><p><del>æµ‹è¯•ï¼Œping ä½ çš„åŸŸåï¼Œè¿”å›æœåŠ¡å™¨ IP è¯´æ˜è§£æç”Ÿæ•ˆ</del></p><p>å¼€å¯å®Œå…¨ SSLï¼Œå¦åˆ™è®¿é—®ç«™ç‚¹ä¼šæŠ¥ã€Œé‡å®šå‘æ¬¡æ•°è¿‡å¤šã€çš„é”™è¯¯</p><p><img src=../../../../Library/Application%20Support/typora-user-images/image-20221121185003309.png alt=image-20221121185003309></p><p>âœ… åŸŸåè§£æå®Œæˆ</p><h2 id=æœåŠ¡å™¨åŸºç¡€é…ç½®>æœåŠ¡å™¨åŸºç¡€é…ç½®</h2><p><strong>å¯¹å“ªä¸€æ­¥ä¸è‡ªä¿¡ï¼Œå¯ä»¥åœ¨å¼€å§‹åšä¹‹å‰å…ˆå»æœåŠ¡å™¨ç®¡ç†é¢æ¿åˆ›å»ºä¸€ä¸ªå¿«ç…§ï¼ˆsnapshotsï¼‰ï¼Œå¿«ç…§å°±æ˜¯å­˜æ¡£ç‚¹</strong></p><h3 id=è¿œç¨‹è¿æ¥>è¿œç¨‹è¿æ¥</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>ssh root@101.113.22.42 <span style=color:#75715e># æ¢æˆä½ çš„ipåœ°å€ï¼Œå›è½¦</span>
</span></span></code></pre></div><p>ç„¶åæŠŠå¯†ç ä» vultr å¤åˆ¶è¿‡æ¥å›è½¦ï¼Œä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„æç¤ºå°±è¡¨ç¤ºè¿æ¥æœåŠ¡å™¨æˆåŠŸ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>Welcome to Ubuntu 22.10 <span style=color:#f92672>(</span>GNU/Linux 5.19.0-23-generic x86_64<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> * Documentation:  https://help.ubuntu.com
</span></span><span style=display:flex><span> * Management:     https://landscape.canonical.com
</span></span><span style=display:flex><span> * Support:        https://ubuntu.com/advantage
</span></span><span style=display:flex><span> ...çœç•¥ä¸€éƒ¨åˆ†å†…å®¹...
</span></span><span style=display:flex><span>root@vultr:~#
</span></span></code></pre></div><h3 id=å®‰å…¨è®¾ç½®>å®‰å…¨è®¾ç½®</h3><p>å› ä¸º root æƒé™å¤ªå¤ªå¤ªå¼ºå¤§ï¼Œä¸ºäº†é¿å…å©´å„¿ï¼ˆæˆ‘ï¼‰æ‹¿æ ¸æ­¦å™¨å‘å°„æŒ‰é’®çš„æƒ…å†µå‡ºç°ï¼Œåˆ›å»ºä¸€ä¸ªæ™®é€šç”¨æˆ·æ—¥å¸¸ä½¿ç”¨</p><h4 id=æ–°å»ºæ™®é€šç”¨æˆ·å¹¶è®¾å®šå¯†ç >æ–°å»ºæ™®é€šç”¨æˆ·å¹¶è®¾å®šå¯†ç </h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>adduser vpsadmin <span style=color:#75715e># vpsadminæ˜¯ç”¨æˆ·å</span>
</span></span></code></pre></div><p>ç„¶åè¾“å…¥å¯†ç  - ç¡®è®¤å¯†ç ï¼ˆå¤ªç®€å•ä¼šè¢«æ‹’ç»==ï¼‰</p><h4 id=èµ‹äºˆ-vpsadmin-ä½¿ç”¨-sudo-æŒ‡ä»¤çš„æƒé™>èµ‹äºˆ ã€Œvpsadminã€ ä½¿ç”¨ sudo æŒ‡ä»¤çš„æƒé™</h4><p>ä»€ä¹ˆæ˜¯ su å’Œ sudo è¯·çœ‹ï¼š<a href=https://blog.gtwang.org/linux/sudo-su-command-tutorial-examples/>Linux çš„ su èˆ‡ sudo æŒ‡ä»¤æ•™å­¸èˆ‡ç¯„ä¾‹</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo adduser vpsadmin sudo
</span></span></code></pre></div><p>å¦å¤–å¼€ä¸€ä¸ªç»ˆç«¯çª—å£ï¼Œç™»å½• vpsadmin è´¦å·</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>ssh vpsadmin@185.202.62.49 <span style=color:#75715e># æ¢æˆä½ çš„IPï¼Œå›è½¦ï¼Œç„¶åè¾“å…¥å¯†ç </span>
</span></span></code></pre></div><p>éªŒè¯æ˜¯å¦è·å¾— sudo æƒé™</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ls -al /root
</span></span></code></pre></div><p>è¿”å›ç±»ä¼¼å†…å®¹ï¼ˆå±•ç¤º <code>/root</code> ç›®å½•ä¸‹çš„èµ„æ–™ï¼‰å°±è¡¨ç¤ºæˆåŠŸäº†</p><h4 id=å¯é€‰ssh-å…å¯†ç™»å½•>[å¯é€‰]SSH å…å¯†ç™»å½•</h4><p>æ¯æ¬¡ç™»å½• vpsadmin éƒ½è¦æ‰‹åŠ¨è¾“å¯†ç å¾ˆéº»çƒ¦ï¼Œè®¾ç½®ä¸€ä¸‹å…å¯†ç™»å½•</p><p>åœ¨ Tabby è®¾ç½® - Profiles & connections - <code>+ New profile</code> - SSH connection</p><h4 id=ç¦æ­¢-root-ç™»å½•>ç¦æ­¢ root ç™»å½•</h4><p>ï¼ˆç¦ç”¨æ ¸æŒ‰é’®ï¼‰</p><p>ç™»å½• root è´¦æˆ·ï¼Œè¾“å…¥</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>nano /etc/ssh/sshd_config
</span></span></code></pre></div><p>ä½¿ç”¨ <code>control + W</code> è¿›å…¥æœç´¢æ¨¡å¼ï¼Œè¾“å…¥ <code>PerimitRootLogin</code> å¹¶å›è½¦ï¼Œæ‰¾åˆ°æ‰€åœ¨è¡Œï¼Œæ”¹æˆï¼ˆè®°å¾—è¦å–æ‰æ³¨é‡Š <code>#</code>ï¼ï¼ï¼‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>PermitRootLogin: no
</span></span></code></pre></div><p>*prohibit-password/without-password æ„ä¸ºç¦æ­¢å¯†ç ç™»å½•</p><p>ä½¿ç”¨ <code>control + O</code>ï¼Œä¿å­˜æ›´æ”¹ï¼Œ<code>control + X</code> é€€å‡º</p><p>é‡æ–°å¯åŠ¨ SSH æœåŠ¡</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo /etc/init.d/ssh restart
</span></span></code></pre></div><p><strong>æ‰“å¼€ä¸€ä¸ªæ–°çª—å£</strong>ï¼Œå°è¯•ç”¨ root ç™»å½•ï¼Œè¿”å› Permission denied&mldr;</p><p>âœ… æˆåŠŸç¦æ­¢ root ç™»å½•</p><p>ä»ç°åœ¨å¼€å§‹ï¼Œç”¨ã€Œvpsadminã€è¿™ä¸ªè´¦æˆ·è¿œç¨‹è¿æ¥ VPS å§</p><h3 id=æ­å»ºç¯å¢ƒ>æ­å»ºç¯å¢ƒ</h3><h4 id=ä¿®æ”¹æœåŠ¡å™¨æ—¶é—´>ä¿®æ”¹æœåŠ¡å™¨æ—¶é—´</h4><p>æŸ¥çœ‹æ—¶é—´</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>timedatectl
</span></span></code></pre></div><p>åˆ—å‡ºæ‰€æœ‰æ—¶åŒº</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>timedatectl list-timezones
</span></span></code></pre></div><p>æ”¹æˆé¦™æ¸¯ ğŸ‡­ğŸ‡°</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo timedatectl set-timezone Asia/Hong_Kong
</span></span></code></pre></div><h4 id=å®‰è£…å¸¸ç”¨å‘½ä»¤>å®‰è£…å¸¸ç”¨å‘½ä»¤</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt-get install curl wget screen tree -y
</span></span></code></pre></div><p>*curl ç”¨äºè¯·æ±‚ Web æœåŠ¡å™¨</p><p>*wget ç”¨æ¥ä¸‹è½½è½¯ä»¶åŒ…</p><p>*screen ç”¨äºå‘½ä»¤è¡Œç»ˆç«¯çš„çª—å£åˆ‡æ¢</p><p>*tree ç”¨äºæ˜¾ç¤ºå½“å‰æ–‡ä»¶å¤¹çš„ç›®å½•ç»“æ„</p><p>ï¼ˆå¦‚æœä½ æœ‰å…¶å®ƒè¦ç”¨çš„ä¹Ÿä¸€èµ·åŠ è¿›æ¥ï¼Œæˆ–è€…è¦ç”¨äº†å†ç”¨è¿™ä¸ªå‘½ä»¤å•ç‹¬å®‰è£…ä¹Ÿå¯ä»¥ï¼‰</p><h4 id=æ·»åŠ -swap>æ·»åŠ  SWAP</h4><p>swap æ˜¯ Linux ä¸­çš„è™šæ‹Ÿå†…å­˜ï¼Œç”¨äºåœ¨ç‰©ç†å†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹å‚¨å­˜ä¸´æ—¶æ•°æ®ï¼Œå¯ä»¥æå‡å°å†…å­˜ VPS çš„è¿è¡Œæ•ˆç‡</p><p>ç¡®è®¤æ˜¯å¦å·²å­˜åœ¨ SWAP</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>free -m
</span></span></code></pre></div><p>æœ‰ Swap é¡¹è€Œä¸” total åˆ—ä¸ä¸ºé›¶ï¼Œè¯´æ˜ Swap å·²å­˜åœ¨ï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹åˆ†åŒºå®¹é‡ï¼Œå‚è€ƒï¼šä¸º <a href=https://www.vvave.net/archives/add-swap-and-repartition-swap-for-linux.html>Linux æ·»åŠ  swap åˆ†åŒºæˆ–ä¿®æ”¹ swap åˆ†åŒºå®¹é‡</a></p><h4 id=é…ç½®é˜²ç«å¢™>é…ç½®é˜²ç«å¢™</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ufw allow OpenSSH
</span></span><span style=display:flex><span>sudo ufw enable
</span></span></code></pre></div><p>æ‰“å¼€é˜²ç«å¢™</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ufw allow http
</span></span><span style=display:flex><span>sudo ufw allow https
</span></span></code></pre></div><p>æ‰“å¼€ 80ã€443 çš„ç«¯å£</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ufw allow 80/tcp
</span></span><span style=display:flex><span>sudo ufw allow 443/tcp
</span></span></code></pre></div><p>ï¼ˆå…¶å®ƒæœåŠ¡éœ€è¦çš„ç«¯å£ä¹Ÿç”¨ <code>sudo ufw allow xx/tcp</code> å¼€å¯ï¼‰</p><p>éªŒè¯é˜²ç«å¢™æ˜¯å¦æ‰“å¼€ï¼Œç«¯å£æ˜¯å¦å¼€å¯</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ufw status
</span></span></code></pre></div><p>å’Œå…¶å®ƒæœåŠ¡å•†ä¸åŒï¼ŒVultr æ²¡æœ‰é»˜è®¤é˜²ç«å¢™è®¾ç½®ï¼Œæ‰€ä»¥è¦è‡ªå·±å¼€å¯</p><p>åœ¨ Vultr æ·»åŠ é˜²ç«å¢™è§„åˆ™</p><h4 id=å®‰è£…-docker-å’Œ-docker-compose>å®‰è£… Docker å’Œ Docker Compose</h4><p>*Compose æ˜¯ Docker çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡ yml æ–‡ä»¶å®šä¹‰ã€åˆ›å»ºã€ç®¡ç†å¤šå®¹å™¨çš„ Docker åº”ç”¨</p><p>è·Ÿç€ <a href=https://www.51cto.com/article/715086.html>å¦‚ä½•åœ¨ Ubuntu 22.04 LTS ä¸­å®‰è£… Docker å’Œ Docker Compose</a> ä¸æ»‘å®Œæˆå®‰è£…</p><p>æ¨èï¼š<a href=https://ostechnix.com/getting-started-with-docker/>Docker Commands Tutorial | Getting Started With Docker In Linux</a></p><h5 id=ä¿®æ”¹-docker-é…ç½®>ä¿®æ”¹ Docker é…ç½®</h5><p>Docker çš„é…ç½®æ–‡ä»¶è·¯å¾„æ˜¯ <code>/etc/docker/daemon.json</code>ï¼Œéœ€è¦æ‰‹åŠ¨åˆ›å»ºï¼š</p><p>è¿›å…¥ <code>/etc/docker</code> ç›®å½•</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cd /etc/docker
</span></span></code></pre></div><p>ç”¨ vim ç¼–è¾‘ <code>daemon.json</code> æ–‡ä»¶</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim daemon.json
</span></span></code></pre></div><p>è¿›å…¥ vim åè¾“å…¥å¦‚ä¸‹å†…å®¹ï¼Œè¿™æ®µä»£ç ä¼šå¢åŠ ä¸€æ®µè‡ªå®šä¹‰å†…ç½‘ IPv6 åœ°å€ï¼Œå¼€å¯å®¹å™¨çš„ IPv6 åŠŸèƒ½ï¼Œé™åˆ¶æ—¥å¿—æ–‡ä»¶çš„å¤§å°ï¼ˆ20Mï¼‰ï¼Œé™åˆ¶æ—¥å¿—æ–‡ä»¶æ•°é‡ï¼Œé˜²æ­¢ Docker æ—¥å¿—è¿‡å¤šå ç”¨ç¡¬ç›˜</p><p>ï¼ˆä»£ç æ¥è‡ª<a href=https://u.sb/debian-install-docker/>çƒ§é¥¼åšå®¢</a>ï¼‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;log-driver&#34;</span>: <span style=color:#e6db74>&#34;json-file&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;log-opts&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;max-size&#34;</span>: <span style=color:#e6db74>&#34;20m&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;max-file&#34;</span>: <span style=color:#e6db74>&#34;3&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;ipv6&#34;</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;fixed-cidr-v6&#34;</span>: <span style=color:#e6db74>&#34;fd00:dead:beef:c0::/80&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;experimental&#34;</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;ip6tables&#34;</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>âš ï¸ vim å’Œæ™®é€šé”®å…¥ç•¥æœ‰ä¸ç”¨</p><ul><li><p>é¦–å…ˆ <code>I</code> è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œè¾“å…¥å†…å®¹ï¼ˆæ³¨æ„æ ¼å¼ï¼šå¤§æ‹¬å· <code>{}</code> é‡Œçš„å†…å®¹é™¤äº†æœ€åä¸€è¡Œï¼Œéƒ½å¿…é¡»ç”¨è‹±æ–‡é€—å· <code>,</code> ç»“å°¾ï¼‰</p></li><li><p>å®Œæˆè¾“å…¥åï¼ŒæŒ‰ <code>esc</code> å›åˆ°ä¸€èˆ¬æ¨¡å¼</p></li><li><p>è¾“å…¥ <code>:wq</code> ï¼Œå›è½¦ï¼ˆæ„ä¸ºä¿å­˜-ç¦»å¼€ï¼‰</p></li><li><p>ä¸æ”¾å¿ƒå¯ä»¥å†æ¬¡è¿›å…¥ daemon.json æ£€æŸ¥æ˜¯å¦æˆåŠŸå†™å…¥ï¼Œæ•ˆæœç±»ä¼¼ï¼š</p></li></ul><p>äº†è§£ï¼š<a href=https://www.runoob.com/linux/linux-vim.html>Linux vi/vim æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆä½¿ç”¨</a></p><p>é‡å¯ Docker æœåŠ¡</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl daemon-reload
</span></span><span style=display:flex><span>sudo systemctl restart docker
</span></span></code></pre></div><h5 id=æ£€æŸ¥-docker-æ˜¯å¦æ­£åœ¨è¿è¡Œ>æ£€æŸ¥ Docker æ˜¯å¦æ­£åœ¨è¿è¡Œ</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl status docker
</span></span></code></pre></div><p>æ¢ä¸ªæ–¹å¼ï¼Œå†æµ‹è¯•ä¸€ä¸‹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo docker run hello-world
</span></span></code></pre></div><p>ç»ˆäºæˆåŠŸäº† ğŸ˜­</p><h2 id=misskey>Misskey</h2><h3 id=åˆ›å»ºå®‰è£…ç›®å½•>åˆ›å»ºå®‰è£…ç›®å½•</h3><p>ä¹‹å‰ç»™ Docker çš„æ•°æ®å’Œé…ç½®æ–‡ä»¶æ–°å»ºä¸€ä¸ªç›®å½• <code>docker_data</code>ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹å°±æ˜¯åŒ…ä½æ•´ä¸ª Misskey çš„ç›’å­</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkdir -p data/docker_data
</span></span></code></pre></div><p>è¿›å…¥ç›®å½•</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cd data/docker_data
</span></span></code></pre></div><p>åˆ›å»º misskey æ–‡ä»¶å¤¹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkdir misskey
</span></span></code></pre></div><h3 id=é…ç½®å®‰è£…æ–‡ä»¶>é…ç½®å®‰è£…æ–‡ä»¶</h3><p>è¿›å…¥ misskey æ–‡ä»¶å¤¹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cd misskey
</span></span></code></pre></div><p>åˆ›å»ºå¹¶ç¼–è¾‘ yml æ–‡ä»¶ï¼Œè®©å®ƒå»éƒ¨ç½²</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim docker-compose.yml
</span></span></code></pre></div><p>æŒ‰ <code>I</code>ï¼Œåˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼ï¼ŒæŠŠä»¥ä¸‹å†…å®¹ç²˜è´´è¿›å»</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e># Misskey minimal deploy config</span>
</span></span><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>web</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span> <span style=color:#75715e># alwaysæ„å‘³ç€è‡ªåŠ¨é‡å¯ï¼Œè¯·æ³¨æ„å¦‚æœæ‚¨å¯¹æ‚¨çš„é…ç½®æ²¡æœ‰ä¿¡å¿ƒï¼Œè¯·ä¸è¦å¼€å¯è¿™ä¸ªé€‰é¡¹ï¼Œä»¥é¿å…è¿›ç¨‹å´©æºƒåå¤é‡å¯è€—è´¹å¤§é‡èµ„æºï¼</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>misskey/misskey:latest</span> <span style=color:#75715e># è¿™é‡Œä½¿ç”¨äº†å®˜æ–¹é•œåƒï¼Œä»¥é¿å…æœ¬åœ°æ„å»ºæ—¶èµ„æºä¸è¶³çš„é—®é¢˜</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>misskey_web</span> <span style=color:#75715e># å®¹å™¨åï¼Œæ–¹ä¾¿ç®¡ç†ï¼Œæ‚¨å¯ä»¥è‡ªè¡Œä¿®æ”¹ä¸ºæ‚¨è§‰å¾—åˆé€‚çš„å†…å®¹</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>links</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>db</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>redis</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#39;3001:3001&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>internal_network</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>external_network</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./config:/misskey/.config:ro</span> <span style=color:#75715e># ç”¨äºæ˜ å°„é…ç½®æ–‡ä»¶ï¼Œè¯·æ ¹æ®æ‚¨çš„å®é™…é…ç½®æ¥å†³å®šæ–‡ä»¶å¤¹åç§°ï¼Œè®¾å®šä¸ºåªè¯»å³å¯ï¼›</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./files:/misskey/files</span> <span style=color:#75715e># ç”¨æˆ·ä¸Šä¼ åˆ°æœ¬åœ°çš„æ–‡ä»¶ï¼Œå¦‚æœæ‚¨ä¸€å¼€å§‹å°±æ¥å…¥å¤–éƒ¨å­˜å‚¨ï¼ˆå¦‚wasabiæˆ–æ˜¯AWS S3ï¼‰æ‚¨å¯ä»¥å¿½ç•¥è¿™å—é…ç½®</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>redis</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>redis:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>misskey_redis</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>internal_network</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./redis:/data</span> <span style=color:#75715e># redisæ•°æ®åº“çš„æ•°æ®æ–‡ä»¶å¤¹æ˜ å°„ï¼Œåˆ›å»ºåé»˜è®¤åœ¨ ./redis æ–‡ä»¶å¤¹ä¸­</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>db</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres:12.2-alpine</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>misskey_db</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>internal_network</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>env_file</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./config/docker.env</span> <span style=color:#75715e># éœ€è¦ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®çš„ Docker ç¯å¢ƒå˜é‡</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./db:/var/lib/postgresql/data</span> <span style=color:#75715e># ä¸»æ•°æ®åº“çš„æ•°æ®æ–‡ä»¶å¤¹æ˜ å°„ï¼Œåˆ›å»ºåé»˜è®¤åœ¨ ./db æ–‡ä»¶å¤¹ä¸­</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>networks</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>internal_network</span>: <span style=color:#75715e># å†…éƒ¨ç½‘ç»œ</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>internal</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>external_network</span>: <span style=color:#75715e># å¤–éƒ¨ç½‘</span>
</span></span></code></pre></div><p>æŒ‰ <code>esc</code> ï¼ŒæŒ‰ <code>:wq</code> ï¼Œå›è½¦ï¼ˆä¿å­˜-é€€å‡ºï¼‰</p><p>åˆ›å»º <code>config/default.yml</code> ç›®å½•å¹¶è¿›å…¥ yml æ–‡ä»¶ä¸­</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkdir config
</span></span><span style=display:flex><span>cd config
</span></span><span style=display:flex><span>sudo vim default.yml
</span></span></code></pre></div><p>æŒ‰ <code>I</code>ï¼Œåˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼ï¼Œå¡«å…¥ä»¥ä¸‹å†…å®¹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#75715e>#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Misskey configuration</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   â”Œâ”€â”€â”€â”€â”€â”</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#â”€â”€â”€â”˜ URL â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Final accessible URL seen by a user.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>url</span>: <span style=color:#ae81ff>https://ponderduck.cc/</span> <span style=color:#75715e># æ³¨æ„æ”¹æˆè‡ªå·±æœ€ååå‘ä»£ç†æƒ³è¦çš„ç½‘å€</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ONCE YOU HAVE STARTED THE INSTANCE, DO NOT CHANGE THE</span>
</span></span><span style=display:flex><span><span style=color:#75715e># URL SETTINGS AFTER THAT!</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#â”€â”€â”€â”˜ Port and TLS settings â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Misskey requires a reverse proxy to support HTTPS connections.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#                 +----- https://example.tld/ ------------+</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   +------+      |+-------------+      +----------------+|</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   | User | ---&gt; || Proxy (443) | ---&gt; | Misskey (3000) ||</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   +------+      |+-------------+      +----------------+|</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#                 +---------------------------------------+</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   You need to set up a reverse proxy. (e.g. nginx)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   An encrypted connection with HTTPS is highly recommended</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   because tokens may be transferred in GET requests.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># The port that your Misskey server should listen on.</span>
</span></span><span style=display:flex><span><span style=color:#f92672>port</span>: <span style=color:#ae81ff>3001</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#â”€â”€â”€â”˜ PostgreSQL configuration â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>db</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>host</span>: <span style=color:#ae81ff>db</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>5432</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Database name</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>db</span>: <span style=color:#ae81ff>misskey</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Auth</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>user</span>: <span style=color:#ae81ff>example-misskey-user</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>pass</span>: <span style=color:#ae81ff>example-misskey-pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Whether disable Caching queries</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#disableCache: true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Extra Connection options</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#extra:</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#  ssl: true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#â”€â”€â”€â”˜ Redis configuration â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>redis</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>host</span>: <span style=color:#ae81ff>redis</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>port</span>: <span style=color:#ae81ff>6379</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#family: 0  # 0=Both, 4=IPv4, 6=IPv6</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#pass: example-pass</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#prefix: example-prefix</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#db: 1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#â”€â”€â”€â”˜ Elasticsearch configuration â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#elasticsearch:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  host: localhost</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  port: 9200</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  ssl: false</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  user:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  pass:</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#â”€â”€â”€â”˜ ID generation â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># You can select the ID generation method.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># You don&#39;t usually need to change this setting, but you can</span>
</span></span><span style=display:flex><span><span style=color:#75715e># change it according to your preferences.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Available methods:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># aid ... Short, Millisecond accuracy</span>
</span></span><span style=display:flex><span><span style=color:#75715e># meid ... Similar to ObjectID, Millisecond accuracy</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ulid ... Millisecond accuracy</span>
</span></span><span style=display:flex><span><span style=color:#75715e># objectid ... This is left for backward compatibility</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># ONCE YOU HAVE STARTED THE INSTANCE, DO NOT CHANGE THE</span>
</span></span><span style=display:flex><span><span style=color:#75715e># ID SETTINGS AFTER THAT!</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>id</span>: <span style=color:#e6db74>&#39;aid&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#â”€â”€â”€â”˜ Other configuration â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Whether disable HSTS</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#disableHsts: true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Number of worker processes</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#clusterLimit: 1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Job concurrency per worker</span>
</span></span><span style=display:flex><span><span style=color:#75715e># deliverJobConcurrency: 128</span>
</span></span><span style=display:flex><span><span style=color:#75715e># inboxJobConcurrency: 16</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Job rate limiter</span>
</span></span><span style=display:flex><span><span style=color:#75715e># deliverJobPerSec: 128</span>
</span></span><span style=display:flex><span><span style=color:#75715e># inboxJobPerSec: 16</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Job attempts</span>
</span></span><span style=display:flex><span><span style=color:#75715e># deliverJobMaxAttempts: 12</span>
</span></span><span style=display:flex><span><span style=color:#75715e># inboxJobMaxAttempts: 8</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># IP address family used for outgoing request (ipv4, ipv6 or dual)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#outgoingAddressFamily: ipv4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Syslog option</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#syslog:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  host: localhost</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  port: 514</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Proxy for HTTP/HTTPS</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#proxy: http://127.0.0.1:3128</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#proxyBypassHosts: [</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  &#39;example.com&#39;,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  &#39;192.0.2.8&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Proxy for SMTP/SMTPS</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#proxySmtp: http://127.0.0.1:3128   # use HTTP/1.1 CONNECT</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#proxySmtp: socks4://127.0.0.1:1080 # use SOCKS4</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#proxySmtp: socks5://127.0.0.1:1080 # use SOCKS5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Media Proxy</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#mediaProxy: https://example.com/proxy</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Proxy remote files (default: false)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#proxyRemoteFiles: true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Sign to ActivityPub GET request (default: false)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#signToActivityPubGet: true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#allowedPrivateNetworks: [</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  &#39;127.0.0.1/32&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Upload or download file size limits (bytes)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#maxFileSize: 262144000</span>
</span></span></code></pre></div><p>æŒ‰ <code>esc</code> ï¼ŒæŒ‰ <code>:wq</code> ï¼Œå›è½¦ï¼ˆä¿å­˜-é€€å‡ºï¼‰</p><p>è¿›å…¥ env æ–‡ä»¶</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim docker.env
</span></span></code></pre></div><p>æŒ‰ <code>I</code>ï¼Œåˆ‡æ¢åˆ°ç¼–è¾‘æ¨¡å¼ï¼Œå¡«å†™å¦‚ä¸‹å†…å®¹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># db settings</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>POSTGRES_PASSWORD=example-misskey-pass</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>POSTGRES_USER=example-misskey-user</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>POSTGRES_DB=misskey</span>
</span></span></code></pre></div><h3 id=éƒ¨ç½²>éƒ¨ç½²</h3><p>è¿˜è®°å¾—æˆ‘è¯´ã€Œåˆ›å»ºå¹¶ç¼–è¾‘ yml æ–‡ä»¶ï¼Œè®©å®ƒå»éƒ¨ç½²ã€å—ï¼Ÿ</p><p>ç°åœ¨æ–‡ä»¶å·²ç»é…ç½®å®Œæ¯•äº†ï¼Œæ˜¯æ—¶å€™è®©å®ƒè·‘èµ·æ¥äº†ï¼</p><p>åŒæ‰‹åˆå ğŸ™</p><p>åˆ‡æ¢åˆ°ä¸Šä¸€çº§ç›®å½•</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cd ..
</span></span></code></pre></div><p>åˆå§‹åŒ–æ•°æ®åº“</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo docker-compose run --rm web yarn run init
</span></span></code></pre></div><p>åå°å¯åŠ¨é¡¹ç›®å®¹å™¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo docker-compose up -d
</span></span></code></pre></div><h3 id=è®¿é—®ç«™ç‚¹>è®¿é—®ç«™ç‚¹</h3><p>æŸ¥çœ‹ç«¯å£çŠ¶æ€</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo lsof -i:&lt;port&gt;
</span></span></code></pre></div><p>å‡å¦‚è¿™ä¸ªç«¯å£ä¸èƒ½ç”¨ï¼Œé‚£å°±æ¢ä¸€ä¸ªã€‚</p><p>æ–°ç«¯å£è¦åœ¨æœåŠ¡å•†é˜²ç«å¢™ã€ufw å‘½ä»¤ã€<code>default.yml</code> å’Œ <code>docker-compose.yml</code> é‡Œéƒ½å¼€å¯ã€æ”¹è¿‡æ¥</p><p>ç„¶åé‡å¯ Docker</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo docker-compose restart <span style=color:#f92672>[</span>æŒ‡å®šæœåŠ¡çš„å®¹å™¨<span style=color:#f92672>]</span>
</span></span></code></pre></div><p>å®Œæˆè¿™ä¸€æ­¥ä¹‹åï¼Œå°è¯•ç”¨ IP è®¿é—®ç«™ç‚¹å§</p><p>åœ¨æµè§ˆå™¨è¾“å…¥ <code>http://&lt;ip>:&lt;port></code>ï¼ˆIP å¯ä»¥ç”¨ <code>curl ip.sb</code> è¿”å›ï¼‰</p><p>ï¼ˆï¼›</p><p>è¿˜æœ‰ä¸¤ä¸ªä»»åŠ¡</p><ul><li>SSL è¯ä¹¦</li><li>åå‘ä»£ç†</li></ul><h3 id=nginx>Nginx</h3><h4 id=å®‰è£…-nginx>å®‰è£… Nginx</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt install nginx
</span></span></code></pre></div><p>è°ƒæ•´é˜²ç«å¢™ï¼Œå…è®¸ Nginx æœåŠ¡é€šè¿‡</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ufw allow <span style=color:#e6db74>&#39;Nginx HTTP&#39;</span>
</span></span><span style=display:flex><span>sudo ufw allow <span style=color:#e6db74>&#39;Nginx HTTPS&#39;</span>
</span></span><span style=display:flex><span>sudo ufw allow <span style=color:#e6db74>&#39;Nginx FULL&#39;</span>
</span></span></code></pre></div><p>æŸ¥çœ‹æ›´æ”¹ç»“æœ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ufw status
</span></span></code></pre></div><p>æŸ¥çœ‹ Nginx çŠ¶æ€ï¼ˆæ˜¯ active å°±è¡Œï¼‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl status nginx
</span></span></code></pre></div><p>åœ¨æµè§ˆå™¨è¾“å…¥ http://your_vps_ipï¼Œè¿”å› Nginx é»˜è®¤é¡µé¢</p><p>è®© Nginx åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl enable nginx
</span></span></code></pre></div><h4 id=è®¾ç½®æœåŠ¡å™¨å—>è®¾ç½®æœåŠ¡å™¨å—</h4><p>åˆ›å»ºç«™ç‚¹å¯¹åº”ç›®å½•</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo mkdir -p /var/www/ponderduck.cc/html
</span></span></code></pre></div><p>ä½¿ç”¨<code>$USER</code>ç¯å¢ƒå˜é‡åˆ†é…ç›®å½•çš„æ‰€æœ‰æƒ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo chown -R $USER:$USER /var/www/ponderduck.cc/html
</span></span></code></pre></div><p>å¦‚æœæˆ‘ä»¬æ²¡æœ‰ä¿®æ”¹è‡ªå·±çš„<code>umask</code>å€¼ï¼Œé‚£ä¹ˆ Web æ ¹ç›®å½•çš„æƒé™åº”è¯¥æ­£ç¡®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥ç¡®è®¤ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo chmod -R <span style=color:#ae81ff>755</span> /var/www/ponderduck.cc
</span></span></code></pre></div><p>ç¼–è¾‘<code>index.html</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /var/www/ponderduck.cc/html/index.html
</span></span></code></pre></div><p>æ·»åŠ ä»¥ä¸‹ç¤ºä¾‹ HTML</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>title</span>&gt;Welcome to ponderduck.cc!&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>h1</span>&gt;Success! The ponderduck.cc server block is working!&lt;/<span style=color:#f92672>h1</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><p>ä¸º Nginx åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨å—</p><p>åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /etc/nginx/sites-available/ponderduck.conf
</span></span></code></pre></div><p>æ·»åŠ ä»¥ä¸‹å†…å®¹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        listen 80;
</span></span><span style=display:flex><span>        listen <span style=color:#f92672>[</span>::<span style=color:#f92672>]</span>:80;
</span></span><span style=display:flex><span>        root /var/www/ponderduck.cc/html;
</span></span><span style=display:flex><span>        index index.html index.htm index.nginx-debian.html;
</span></span><span style=display:flex><span>        server_name ponderduck.cc www.ponderduck.cc;
</span></span><span style=display:flex><span>        location / <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>                try_files $uri $uri/ <span style=color:#f92672>=</span>404;
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>é€šè¿‡ ls å‘½ä»¤åœ¨<code>sites-enabled</code>ç›®å½•æ–°å»ºä¸€ä¸ªé“¾æ¥ï¼Œå¥½è®© Nginx åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ä¼šè¯»å–è¿™ä¸ªç›®å½•ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ln -s /etc/nginx/sites-available/ponderduck.conf /etc/nginx/sites-enabled/
</span></span></code></pre></div><p>æ‰“å¼€æ–‡ä»¶ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /etc/nginx/nginx.conf
</span></span></code></pre></div><p>æ‰¾åˆ°<code>server_names_hash_bucket_size</code>æŒ‡ä»¤å¹¶åˆ é™¤<code>#</code>ç¬¦å·ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>...
</span></span><span style=display:flex><span>http <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    server_names_hash_bucket_size 64;
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæµ‹è¯•ä»¥ç¡®ä¿æˆ‘ä»¬åœ¨ Nginx æ–‡ä»¶ä¸­çš„æ”¹åŠ¨ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nginx -t
</span></span></code></pre></div><p>å¦‚æœæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·é‡æ–°å¯åŠ¨ Nginxï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl restart nginx
</span></span></code></pre></div><p>ç°åœ¨é€šè¿‡ <a href=http://ponderduck.cc>http://ponderduck.cc</a> è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™ï¼ŒNginx ä¼šæŒ‡å‘æˆ‘ä»¬åˆšåˆšæ·»åŠ çš„é‚£ä¸ª HTML é¡µé¢</p><h4 id=ssl>SSL</h4><h5 id=å®‰è£…-certbot>å®‰è£… Certbot</h5><p>æˆ‘ä»¬éœ€è¦è·å¾—è¢«ä¿¡ä»»çš„è¯ä¹¦æˆæƒä¸­å¿ƒï¼ˆ CA ï¼‰ç­¾å‘çš„å®‰å…¨è¯ä¹¦ã€‚Letâ€™s Encrypt æ˜¯ ISRG ï¼ˆ Internet Security Research Group ï¼Œäº’è”ç½‘å®‰å…¨ç ”ç©¶å°ç»„ï¼‰çš„ç»„ç»‡æ¨å‡ºçš„å…è´¹å®‰å…¨è¯ä¹¦è®¡åˆ’ã€‚</p><p>ISRG çš„å‘èµ·è€… EFF ï¼ˆç”µå­å‰å“¨åŸºé‡‘ä¼šï¼‰ä¸º Letâ€™s Encrypt é¡¹ç›®å‘å¸ƒäº†ä¸€ä¸ªå®˜æ–¹çš„å®¢æˆ·ç«¯ Certbot ï¼Œåˆ©ç”¨å®ƒå¯ä»¥å®Œå…¨è‡ªåŠ¨åŒ–çš„è·å–ã€éƒ¨ç½²å’Œæ›´æ–°å®‰å…¨è¯ä¹¦</p><p>å®‰è£… Certbot</p><p>å» <a href=https://certbot.eff.org/>å®˜ç½‘</a> é€‰æ‹©æˆ‘æ­£åœ¨ä½¿ç”¨çš„ Web æœåŠ¡å™¨ï¼ˆNginxï¼‰å’Œæ“ä½œç³»ç»Ÿï¼ˆUbuntu 20ï¼‰ï¼Œæ“ä½œå¯¹åº”çš„å®‰è£…æ­¥éª¤</p><p>Ubuntu è‡ªå¸¦ Snapï¼Œç”¨ Snap å®‰è£… Certbot</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo snap install --classic certbot
</span></span></code></pre></div><p>ç”¨ ln å‘½ä»¤åˆ›å»ºç¬¦å·è¿æ¥ï¼Œå°† Certbot åŠ å…¥ PATH ç¯å¢ƒå˜é‡ä¸­</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo ln -s /snap/bin/certbot /usr/bin/certbot
</span></span></code></pre></div><h5 id=ç”Ÿæˆ-ssl-è¯ä¹¦>ç”Ÿæˆ SSL è¯ä¹¦</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo certbot --nginx -d www.ponderduck.cc
</span></span></code></pre></div><p>è¾“å…¥é‚®ç®±åœ°å€ï¼Œç”¨äºæ¥æ”¶é‚®ä»¶</p><p>è¾“å…¥ <code>Y</code>ï¼ŒåŒæ„åè®®ï¼›è¯¢é—®æ˜¯å¦æ¥æ”¶å‰å“¨åŸºé‡‘ä¼šçš„é‚®ä»¶ï¼Œæ¥ä¸æ¥æ”¶éƒ½è¡Œ</p><p>è¿”å›ï¼ˆæ³¨æ„è¯ä¹¦å‚¨å­˜ä½ç½®ï¼‰</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>Successfully received certificate.
</span></span><span style=display:flex><span>Certificate is saved at: /etc/letsencrypt/live/www.ponderduck.cc/fullchain.pem
</span></span><span style=display:flex><span>Key is saved at:         /etc/letsencrypt/live/www.ponderduck.cc/privkey.pem
</span></span><span style=display:flex><span>This certificate expires on 2023-02-18.
</span></span><span style=display:flex><span>These files will be updated when the certificate renews.
</span></span><span style=display:flex><span>Certbot has set up a scheduled task to automatically renew this certificate in the background.
</span></span></code></pre></div><p>Let&rsquo;s Encrypt çš„ SSL è¯ä¹¦ä¼šåœ¨ 90 å¤©åè¿‡æœŸï¼Œä½†æ˜¯ Certbot ä¼šè‡ªåŠ¨ç»­è®¢</p><p>æµ‹è¯•è¯ä¹¦è‡ªåŠ¨ç»­è®¢æ˜¯å¦ç”Ÿæ•ˆ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo certbot renew --dry-run
</span></span></code></pre></div><p>è¿”å› â¬‡ï¸ è¯´æ˜å·²ç”Ÿæ•ˆ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>Simulating renewal of an existing certificate for www.ponderduck.cc
</span></span></code></pre></div><p>æ‰¾åˆ°å­˜æ”¾ç«™ç‚¹è¯ä¹¦çš„ç›®å½•</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo ls /etc/letsencrypt/live
</span></span></code></pre></div><p>æˆ‘çš„æ˜¯<code>www.ponderduck.cc</code></p><p>æŸ¥è¯¢è¯ä¹¦</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo ls /etc/letsencrypt/live/www.ponderduck.cc
</span></span></code></pre></div><p>è¿”å›æ–‡ä»¶å</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>cert.pem  chain.pem  fullchain.pem  privkey.pem
</span></span></code></pre></div><p>åä¸¤ä¸ªè¦æ·»åŠ åˆ° Nginx é…ç½®æ–‡ä»¶ <code>.conf</code> é‡Œ</p><h4 id=åå‘ä»£ç†>åå‘ä»£ç†</h4><p>ä¿®æ”¹ç½‘ç«™é…ç½®æ–‡ä»¶</p><p>å‚è€ƒ <a href=https://misskey-hub.net/en/docs/admin/nginx.html>å®˜ç½‘æ–‡æ¡£</a>ï¼Œä»¥ä¸‹æ˜¯æˆ‘çš„å®Œæ•´æ–‡ä»¶å†…å®¹</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span># For WebSocket
</span></span><span style=display:flex><span>map $http_upgrade $connection_upgrade {
</span></span><span style=display:flex><span>    default upgrade;
</span></span><span style=display:flex><span>    &#39;&#39;      close;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>proxy_cache_path /tmp/nginx_cache levels=1:2 keys_zone=cache1:16m max_size=1g inactive=720m use_temp_path=off;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>server {
</span></span><span style=display:flex><span>       listen 80;
</span></span><span style=display:flex><span>       listen [::]:80;
</span></span><span style=display:flex><span>       server_name www.ponderduck.cc ponderduck.cc;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       # For SSL domain validation
</span></span><span style=display:flex><span>       root /var/www/html;
</span></span><span style=display:flex><span>       location /.well-known/acme-challenge/ { allow all; }
</span></span><span style=display:flex><span>       location /.well-known/pki-validation/ { allow all; }
</span></span><span style=display:flex><span>       location / { return 301 https://$server_name$request_uri; }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>server {
</span></span><span style=display:flex><span>        listen [::]:443 ssl http2;
</span></span><span style=display:flex><span>        listen 443 ssl http2;
</span></span><span style=display:flex><span>        server_name ponderduck.cc www.ponderduck.cc;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ssl_session_cache shared:ssl_session_cache:10m;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        # ssl
</span></span><span style=display:flex><span>        ssl_certificate /etc/letsencrypt/live/www.ponderduck.cc/fullchain.pem;
</span></span><span style=display:flex><span>        ssl_certificate_key /etc/letsencrypt/live/www.ponderduck.cc/privkey.pem;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        include /etc/letsencrypt/options-ssl-nginx.conf;
</span></span><span style=display:flex><span>        ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
</span></span><span style=display:flex><span>        ssl_stapling on;
</span></span><span style=display:flex><span>        ssl_stapling_verify on;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        # Change to your upload limit
</span></span><span style=display:flex><span>        client_max_body_size 80m;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        # å¯¹&#34;/&#34;å¯ç”¨åå‘ä»£ç†
</span></span><span style=display:flex><span>        location / {
</span></span><span style=display:flex><span>                # æŒ‡å®šè½¬å‘åœ°å€
</span></span><span style=display:flex><span>                proxy_pass http://127.0.0.1:3001;
</span></span><span style=display:flex><span>                proxy_set_header Host $host;
</span></span><span style=display:flex><span>                proxy_http_version 1.1;
</span></span><span style=display:flex><span>                proxy_redirect off;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                proxy_set_header   Upgrade             $http_upgrade;
</span></span><span style=display:flex><span>                proxy_set_header   Connection          $connection_upgrade;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                proxy_cache cache1;
</span></span><span style=display:flex><span>                proxy_cache_lock on;
</span></span><span style=display:flex><span>                proxy_cache_use_stale updating;
</span></span><span style=display:flex><span>                add_header X-Cache $upstream_cache_status;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæµ‹è¯•ä»¥ç¡®ä¿æˆ‘ä»¬åœ¨ Nginx æ–‡ä»¶ä¸­çš„æ”¹åŠ¨ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nginx -t
</span></span></code></pre></div><p>æœ‰é—®é¢˜çš„è¯æŒ‰ç…§æç¤ºä¿®æ”¹ï¼Œåšå®Œä¹‹åï¼Œé‡æ–°å¯åŠ¨ Nginxï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl restart nginx
</span></span></code></pre></div><p>ç°åœ¨ SSL è¯ä¹¦å’Œåå‘ä»£ç†éƒ½ç”Ÿæ•ˆäº†ï¼Œå°è¯•ç”¨åŸŸåè®¿é—®ç«™ç‚¹</p><p>å®Œæˆ ğŸ‰</p><p>æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œå›åˆ°å‘½ä»¤è¡Œå·¥å…·æŠŠå®ƒè®¾ç½®ä¸ºç®¡ç†å‘˜</p><h2 id=æ—¥å¸¸ç»´æŠ¤>æ—¥å¸¸ç»´æŠ¤</h2><h3 id=æ›´æ–°>æ›´æ–°</h3><p>Docker-compose éƒ¨ç½²</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cd data/docker_data/misskey
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker-compose down
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cp -r /root/data/docker_data/misskey /root/data/docker_data/misskey.archive  <span style=color:#75715e># ä¸‡äº‹å…ˆå¤‡ä»½ï¼Œä»¥é˜²ä¸‡ä¸€ï¼Œå…¶å®è¿™è¾¹æ²¡å¿…è¦ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰æ˜ å°„åˆ°æœ¬åœ°æ–‡ä»¶å¤¹</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker-compose pull
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker-compose up -d    <span style=color:#75715e># è¯·ä¸è¦ä½¿ç”¨docker-compose stopæ¥åœæ­¢å®¹å™¨ï¼Œå› ä¸ºè¿™ä¹ˆåšéœ€è¦é¢å¤–çš„æ—¶é—´ç­‰å¾…å®¹å™¨åœæ­¢ï¼›docker-compose up -dç›´æ¥å‡çº§å®¹å™¨æ—¶ä¼šè‡ªåŠ¨åœæ­¢å¹¶ç«‹åˆ»é‡å»ºæ–°çš„å®¹å™¨ï¼Œå®Œå…¨æ²¡æœ‰å¿…è¦æµªè´¹é‚£äº›æ—¶é—´ã€‚</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker image prune  <span style=color:#75715e># prune å‘½ä»¤ç”¨æ¥åˆ é™¤ä¸å†ä½¿ç”¨çš„ docker å¯¹è±¡ã€‚åˆ é™¤æ‰€æœ‰æœªè¢« tag æ ‡è®°å’Œæœªè¢«å®¹å™¨ä½¿ç”¨çš„é•œåƒ</span>
</span></span></code></pre></div><p>æç¤ºï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>WARNING! This will remove all dangling images.
</span></span><span style=display:flex><span>Are you sure you want to continue? [y/N]
</span></span></code></pre></div><p>è¾“å…¥ <code>y</code></p><h3 id=å¸è½½>å¸è½½</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>cd /root/data/docker_data/misskey
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker-compose down
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>rm -rf /root/data/docker_data/misskey  # å®Œå…¨åˆ é™¤æ˜ å°„åˆ°æœ¬åœ°çš„æ•°æ®
</span></span></code></pre></div><h3 id=åˆ é™¤æ—§æ•°æ®>åˆ é™¤æ—§æ•°æ®</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>docker system prune
</span></span></code></pre></div><h3 id=ç£ç›˜ç©ºé—´åˆ†æåŠæ¸…ç†>ç£ç›˜ç©ºé—´åˆ†æåŠæ¸…ç†</h3><p>å†…å®¹ä¸»è¦æ¥æºï¼šhttps://www.cnblogs.com/jing99/p/10487174.html</p><p>æœ‰æ—¶å€™è¦ç”¨ <code>sudo</code></p><h4 id=df-å‘½ä»¤>df å‘½ä»¤</h4><p>å¯ä»¥æŸ¥çœ‹ä¸€çº§æ–‡ä»¶å¤¹å¤§å°ã€ä½¿ç”¨æ¯”ä¾‹ã€æ¡£æ¡ˆç³»ç»Ÿå’ŒæŒ‚å…¥ dian</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>[root@oms ~]# df -Th
</span></span><span style=display:flex><span>Filesystem     Type      Size  Used Avail Use% Mounted on
</span></span><span style=display:flex><span>/dev/vda1      ext4       40G   35G  3.1G  92% /
</span></span><span style=display:flex><span>devtmpfs       devtmpfs  1.9G     0  1.9G   0% /dev
</span></span><span style=display:flex><span>tmpfs          tmpfs     1.9G     0  1.9G   0% /dev/shm
</span></span><span style=display:flex><span>tmpfs          tmpfs     1.9G  191M  1.7G  11% /run
</span></span><span style=display:flex><span>tmpfs          tmpfs     1.9G     0  1.9G   0% /sys/fs/cgroup
</span></span><span style=display:flex><span>tmpfs          tmpfs     379M     0  379M   0% /run/user/0
</span></span></code></pre></div><p>ä¸ƒä¸ªå­—æ®µåˆ†åˆ«ä¸ºæ¡£æ¡ˆç³»ç»Ÿã€ç±»å‹ã€è¯¥åˆ†å‰²åŒºçš„å®¹é‡ã€å·²ä½¿ç”¨çš„å¤§å°ã€å‰©ä¸‹çš„å¤§å°ã€ä½¿ç”¨çš„ç™¾åˆ†æ¯”å’ŒæŒ‚å…¥ç‚¹</p><h4 id=du-å‘½ä»¤>du å‘½ä»¤</h4><p>ç”¨æ¥æŸ¥çœ‹ç›®å½•æˆ–æ–‡ä»¶æ‰€å ç”¨ç£ç›˜ç©ºé—´çš„å¤§å°ã€‚å¸¸ç”¨é€‰é¡¹ç»„åˆä¸ºï¼š<code>du -sh [ç›®å½•]</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>du -s ç›®å½• | sort -rn        #è¿™æ˜¯æŒ‰å­—èŠ‚æ’åº
</span></span><span style=display:flex><span>du -sh ç›®å½• | sort -rn        #è¿™æ˜¯æŒ‰å…†ï¼ˆMï¼‰æ¥æ’åº
</span></span><span style=display:flex><span>#ç”±äº-shå¤§å°æ˜¾ç¤ºçœ‹èµ·æ¥æ˜¯ä¹±çš„ï¼Œå› æ­¤å»ºè®®ä½¿ç”¨du -s|sort -nr
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>du -s ç›®å½• | sort -rn | head        #é€‰å‡ºæ’åœ¨å‰é¢çš„10ä¸ª
</span></span><span style=display:flex><span>du -s ç›®å½• | sort -rn | tail        #é€‰å‡ºæ’åœ¨åé¢çš„10ä¸ª
</span></span></code></pre></div><p>å¸¸ç”¨é€‰é¡¹</p><blockquote><p>-hï¼šä»¥äººç±»å¯è¯»çš„æ–¹å¼æ˜¾ç¤º</p><p>-aï¼šæ˜¾ç¤ºç›®å½•å ç”¨çš„ç£ç›˜ç©ºé—´å¤§å°ï¼Œè¿˜è¦æ˜¾ç¤ºå…¶ä¸‹ç›®å½•å’Œæ–‡ä»¶å ç”¨ç£ç›˜ç©ºé—´çš„å¤§å°</p><p>-sï¼šåªæ˜¾ç¤º<strong>ç›®å½•å ç”¨çš„ç£ç›˜ç©ºé—´</strong>å¤§å°ï¼Œä¸æ˜¾ç¤ºå…¶å­ç›®å½•å’Œæ–‡ä»¶å ç”¨çš„ç£ç›˜ç©ºé—´å¤§å°</p><p>-cï¼šæ˜¾ç¤ºå‡ ä¸ª<strong>ç›®å½•æˆ–æ–‡ä»¶å ç”¨çš„ç£ç›˜</strong>ç©ºé—´å¤§å°ï¼Œè¿˜è¦ç»Ÿè®¡å®ƒä»¬çš„æ€»å’Œ</p><p>&ndash;apparent-sizeï¼šæ˜¾ç¤ºç›®å½•æˆ–æ–‡ä»¶è‡ªèº«çš„å¤§å°(æ–‡ä»¶æˆ–ç›®å½•å ç”¨ç£ç›˜ç©ºé—´çš„å¤§å°ä¸å®ƒä»¬è‡ªèº«å¤§å°æœ‰æ—¶å€™å¹¶éå®Œå…¨ä¸€è‡´)</p><p>-l ï¼šç»Ÿè®¡ç¡¬é“¾æ¥å ç”¨ç£ç›˜ç©ºé—´çš„å¤§å°</p><p>-Lï¼šç»Ÿè®¡ç¬¦å·é“¾æ¥æ‰€æŒ‡å‘çš„æ–‡ä»¶å ç”¨çš„ç£ç›˜ç©ºé—´å¤§å°ã€‚</p></blockquote><h4 id=rm-å‘½ä»¤>rm å‘½ä»¤</h4><p>æ…ç”¨</p><p>ä»¥ä¸‹å¾…åšï¼š</p><p><a href=https://fediverse.eu.org/discussion/15/%E7%BB%99%E6%96%B0%E7%AB%99%E9%95%BF-%E5%BB%BA%E7%AB%99%E5%90%8E%E5%8F%AF%E5%8F%82%E8%80%83%E7%9A%84%E8%BF%90%E7%BB%B4%E5%8F%8A%E8%A3%85%E4%BF%AE%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C#latest>https://fediverse.eu.org/discussion/15/%E7%BB%99%E6%96%B0%E7%AB%99%E9%95%BF-%E5%BB%BA%E7%AB%99%E5%90%8E%E5%8F%AF%E5%8F%82%E8%80%83%E7%9A%84%E8%BF%90%E7%BB%B4%E5%8F%8A%E8%A3%85%E4%BF%AE%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C#latest</a></p><p><a href=https://pullopen.github.io/tags/#Mastodon>https://pullopen.github.io/tags/#Mastodon</a></p><ul><li>æ‰«æå‡ºä¸å±äºä»»ä½•åª’ä½“é™„ä»¶çš„æ–‡ä»¶å¹¶ç§»é™¤ä»–ä»¬</li><li>æ¸…é™¤ç¼“å­˜å­˜å‚¨</li><li>ä»æ•°æ®åº“ä¸­åˆ é™¤æœªè¢«å¼•ç”¨çš„å˜Ÿæ–‡ï¼Œä¾‹å¦‚æ¥è‡ªä¸­ç»§çš„æˆ–æ¥è‡ªæœ¬åœ°ç”¨æˆ·ä¸å†å…³æ³¨çš„ç”¨æˆ·çš„å˜Ÿæ–‡ï¼ŒåŒæ—¶æ²¡æœ‰è¢«å›å¤çš„æˆ–ä»¥å…¶ä»–æ–¹å¼ä¸ä¹‹äº’åŠ¨çš„</li></ul><h3 id=å¸¸ç”¨å‘½ä»¤>å¸¸ç”¨å‘½ä»¤</h3><p>æŸ¥çœ‹ docker å®¹å™¨çŠ¶æ€</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-fallback data-lang=fallback><span style=display:flex><span>sudo docker container stats
</span></span></code></pre></div><h2 id=å…¶å®ƒå‚è€ƒ>å…¶å®ƒå‚è€ƒ</h2><p><a href=https://blog.laoda.de/archives/getting-started-with-linux>mjj ç‰ˆçš„ linux å…¥é—¨æ•™ç¨‹</a></p><p><a href=https://weirenxue.github.io/2021/06/17/user_linux_sudo/>[User] Linux æ–°å¢ä½¿ç”¨è€…ä¸¦è³¦äºˆå…¶ä½¿ç”¨ sudo çš„æ¬Šé™</a></p><p><a href=https://blog.laoda.de/archives/how-to-secure-a-linux-server>ä¿æŠ¤å¥½ä½ çš„å°é¸¡ï¼ä¿å§†çº§æœåŠ¡å™¨å®‰å…¨æ•™ç¨‹ï¼</a></p><p><a href=https://blog.laoda.de/archives/docker-compose-install-misskey#5.3-%E5%AE%89%E8%A3%85nginxproxymanager>ã€å¥½ç©å„¿çš„ Docker é¡¹ç›®ã€‘10 åˆ†é’Ÿæ­å»ºä¸€ä¸ªå»ä¸­å¿ƒåŒ–å¾®åšå¹³å°â€”â€”Misskey ï½œäºŒæ¬¡å…ƒé£æ ¼ã€è”é‚¦å®‡å®™</a></p><p><a href=https://candinya.com/posts/minimal-misskey-docker-deploy/>ä½¿ç”¨ Docker æœ€å°åŒ–éƒ¨ç½² Misskey</a></p><p><a href=https://eri.cx/build-your-own-decentralized-social-platform-misskey/>æ­å»ºå±äºè‡ªå·±çš„å»ä¸­å¿ƒåŒ–ç¤¾äº¤å¹³å° Misskey</a></p><p><a href=https://kalacloud.com/blog/how-to-install-nginx-on-ubuntu-20-04/#%E7%AC%AC5%E6%AD%A5%E8%AE%BE%E7%BD%AE%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9D%97server-block>å¦‚ä½•åœ¨ Ubuntu 20.04 ä¸­å®‰è£…å’Œé…ç½® Nginx</a></p><p><a href=https://zxuqian.cn/install-nginx-on-ubuntu-20-04/>Nginx æ•™ç¨‹ï¼šå¦‚ä½•åœ¨ Ubuntu 20.04 ä¸‹å®‰è£…å¹¶é…ç½® Nginx</a></p><p><a href=https://www.myfreax.com/secure-nginx-with-let-s-encrypt-on-ubuntu-20-04/>å¦‚ä½•åœ¨ Ubuntu 20.04 Nginx é…ç½® Let&rsquo;s Encrypt SSL è¯ä¹¦</a></p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/tutorial>tutorial</a></li><li><a href=/tags/misskey>misskey</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/falasool/ rel=me title=GitHub><i data-feather=github></i></a><a class=soc href=https://gitlab.com/athul/ rel=me title=GitLab><i data-feather=gitlab></i></a></div><div class=footer-info>2025 Â© Falaool<br>Built with <a href=https://gohugo.io>Hugo</a> & Theme <a href=https://github.com/athul/archie>Archie</a> design by Athul</div></footer><script>feather.replace()</script></div></body></html>
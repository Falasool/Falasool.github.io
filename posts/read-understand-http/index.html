<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>阅读 ｜《图解HTTP》 - Falasool</title><link rel=icon type=image/png href=static/img/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="{\{< neodb &#34;https://neodb.social/book/3BVOzAS5pkNSWDfRT5CMkn&#34; >}\} 阅读笔记，讲得比较浅，结构有点散，但还是收获了一些 HTTP 协议 用于服务端和客户端之间的通信 // 请求报文： // 请求方法 + uri + 协议版本 + [请求首部"><meta property="og:image" content><meta property="og:title" content="阅读 ｜《图解HTTP》"><meta property="og:description" content="{\{< neodb &#34;https://neodb.social/book/3BVOzAS5pkNSWDfRT5CMkn&#34; >}\} 阅读笔记，讲得比较浅，结构有点散，但还是收获了一些 HTTP 协议 用于服务端和客户端之间的通信 // 请求报文： // 请求方法 + uri + 协议版本 + [请求首部"><meta property="og:type" content="article"><meta property="og:url" content="https://falasool.github.io/posts/read-understand-http/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-07T19:13:22+08:00"><meta property="article:modified_time" content="2024-03-07T19:13:22+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="阅读 ｜《图解HTTP》"><meta name=twitter:description content="{\{< neodb &#34;https://neodb.social/book/3BVOzAS5pkNSWDfRT5CMkn&#34; >}\} 阅读笔记，讲得比较浅，结构有点散，但还是收获了一些 HTTP 协议 用于服务端和客户端之间的通信 // 请求报文： // 请求方法 + uri + 协议版本 + [请求首部"><script src=https://falasool.github.io/js/feather.min.js></script>
<link href=https://falasool.github.io/css/fonts.4bacf4386d3f58fdc378d205a903311c80158bf414d25698589b658e0273156d.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://falasool.github.io/css/main.409b4163748cd4906669e4c6d5a0483433fd78fba4753a71f4d1748dbc962736.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://falasool.github.io/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css media="(prefers-color-scheme: dark)"></head><body><div class=content><header><div class=main><a href=https://falasool.github.io/>Falasool</a></div><nav><a href=/friends/></a>
<a href=/about>About</a>
<a href=/friends>Friends</a>
<a href=/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>阅读 ｜《图解HTTP》</h1><div class=meta>Posted on Mar 7, 2024</div></div><section class=body><p><code>{\{&lt; neodb "https://neodb.social/book/3BVOzAS5pkNSWDfRT5CMkn" >}\}</code></p><p>阅读笔记，讲得比较浅，结构有点散，但还是收获了一些</p><h2 id=http-协议>HTTP 协议</h2><p>用于服务端和客户端之间的通信</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#75715e>// 请求报文：
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 请求方法 + uri + 协议版本 + [请求首部字段] + 内容实体
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 请求头 + 请求行 + 请求体，每一部分用换行符区分
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>GET</span> <span style=color:#f92672>/</span><span style=color:#a6e22e>index</span>.<span style=color:#a6e22e>htm</span> <span style=color:#a6e22e>HTTP</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1.1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Host</span><span style=color:#f92672>:</span><span style=color:#a6e22e>hackr</span>.<span style=color:#a6e22e>ip</span>
</span></span></code></pre></div><ul><li>HTTP 是一种无状态 stateless 协议，状态交给 cookie etc.</li></ul><h3 id=cookie>Cookie</h3><p>使用 cookie 进行状态管理，通过在请求、响应报文中添加 cookie 信息控制客户端的状态</p><ul><li>cookie 产生于服务端，包含在发送给客户端的 header 里的 set-cookie 字段</li><li>客户端根据 set-cookie 保存一段纯文本信息</li><li>再次向服务端发请求时，请求报文会带上这个 cookicookie</li><li>服务端接收到 cookie 和服务端记录对比，得到之前的状态信息</li></ul><p>为 Cookie 服务的头部字段见 [[HTTP#Cookie 相关字段]]</p><p>用 Cookie 管理 Session（会话）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>Set</span><span style=color:#f92672>-</span><span style=color:#a6e22e>Cookie</span><span style=color:#f92672>:&lt;</span><span style=color:#a6e22e>Session</span><span style=color:#f92672>-</span><span style=color:#a6e22e>ID</span><span style=color:#f92672>&gt;</span>
</span></span></code></pre></div><h3 id=ajax>Ajax</h3><p>解决 HTTP 的缺点：</p><ul><li>1 条链接上只能发一个请求</li><li>头部未经压缩就发送，头部信息越多延迟越大</li><li>请求只能从客户端开始，客户端不能接收响应以外的指令</li></ul><p>核心 API：<code>XMLHttpRequest</code> 实现无刷新局部更新</p><h3 id=http-头部>HTTP 头部</h3><h4 id=通用头部字段>通用头部字段</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>Cache</span><span style=color:#f92672>-</span><span style=color:#a6e22e>control</span><span style=color:#f92672>:</span><span style=color:#66d9ef>private</span>,<span style=color:#a6e22e>max</span><span style=color:#f92672>-</span><span style=color:#a6e22e>age</span><span style=color:#f92672>:</span><span style=color:#ae81ff>0</span>,<span style=color:#a6e22e>no</span><span style=color:#f92672>-</span><span style=color:#a6e22e>cache</span> <span style=color:#75715e>// 控制缓存
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Collection</span><span style=color:#f92672>:</span><span style=color:#a6e22e>close</span> <span style=color:#75715e>// 断开连接
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>...
</span></span></code></pre></div><h4 id=请求头部字段>请求头部字段</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>User</span><span style=color:#f92672>-</span><span style=color:#a6e22e>Agent</span><span style=color:#f92672>:</span><span style=color:#a6e22e>Mozilla</span><span style=color:#f92672>/</span><span style=color:#ae81ff>5.0</span> <span style=color:#75715e>// 将创建请求的浏览器和用户代理名称等信息发给服务端，写爬虫用
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Accept</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>text</span><span style=color:#f92672>/</span><span style=color:#a6e22e>html</span> <span style=color:#75715e>// 通知服务端，用户代理能处理的数据类型/格式和q权重
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Authorization</span><span style=color:#f92672>:</span><span style=color:#a6e22e>Basic</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>dWufaslngafaJFljfsl</span><span style=color:#f92672>==</span> <span style=color:#75715e>// 通知服务端，用户代理的认证信息
</span></span></span><span style=display:flex><span><span style=color:#75715e>// If-xxx 条件请求
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>If</span><span style=color:#f92672>-</span><span style=color:#a6e22e>Modified</span><span style=color:#f92672>-</span><span style=color:#a6e22e>Since</span><span style=color:#f92672>:</span><span style=color:#a6e22e>Thu</span>,<span style=color:#ae81ff>15</span> <span style=color:#a6e22e>Apr</span> <span style=color:#ae81ff>2004</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>00</span><span style=color:#f92672>:</span><span style=color:#ae81ff>00</span><span style=color:#f92672>:</span><span style=color:#ae81ff>00</span> <span style=color:#a6e22e>GMT</span> <span style=color:#75715e>// 如果在指定日期之后，资源发生了更新，服务端才会接受请求，用于确认本地资源的有效性
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Range</span><span style=color:#f92672>:</span><span style=color:#a6e22e>bytes</span><span style=color:#f92672>=</span><span style=color:#ae81ff>5000</span><span style=color:#f92672>-</span><span style=color:#ae81ff>10000</span>
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><h4 id=响应头部字段>响应头部字段</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>Age</span><span style=color:#f92672>:</span><span style=color:#ae81ff>600</span> <span style=color:#75715e>// 源服务器600s前创建了响应
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Server</span><span style=color:#f92672>:</span><span style=color:#a6e22e>Apache</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2.2</span>.<span style=color:#ae81ff>17</span>(<span style=color:#a6e22e>Unix</span>) <span style=color:#75715e>// 当前服务器上HTTP服务器的信息
</span></span></span></code></pre></div><h4 id=实体头部字段>实体头部字段</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>Content</span><span style=color:#f92672>-</span><span style=color:#a6e22e>Language</span><span style=color:#f92672>:</span><span style=color:#a6e22e>zh</span><span style=color:#f92672>-</span><span style=color:#a6e22e>CN</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Content</span><span style=color:#f92672>-</span><span style=color:#a6e22e>Length</span><span style=color:#f92672>:</span><span style=color:#ae81ff>15000</span> <span style=color:#75715e>// 实体主体的大小（字节）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Content</span><span style=color:#f92672>-</span><span style=color:#a6e22e>Type</span><span style=color:#f92672>:</span><span style=color:#a6e22e>text</span><span style=color:#f92672>/</span><span style=color:#a6e22e>html</span>;<span style=color:#a6e22e>charset</span><span style=color:#f92672>=</span><span style=color:#a6e22e>UTF</span><span style=color:#f92672>-</span><span style=color:#ae81ff>8</span> <span style=color:#75715e>// 实体主体内对象的媒体类型
</span></span></span></code></pre></div><h5 id=cookie-相关字段>Cookie 相关字段</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>Set</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>Cookie</span> <span style=color:#75715e>// 响应头部字段
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Cookie</span> <span style=color:#75715e>// 请求头部字段
</span></span></span></code></pre></div><h4 id=其他头部字段>其他头部字段</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>X</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>Frame</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>Options</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>X</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>XSS</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>Protection</span>
</span></span></code></pre></div><h3 id=http11-中的-7-种方法>HTTP/1.1 中的 7 种方法</h3><h4 id=get>GET</h4><p>请求资源</p><h4 id=post>POST</h4><p>发送实体的主体 entity body</p><h4 id=put>PUT</h4><p>传输文件，类似 POST，但是没有验证机制，几乎不使用</p><h4 id=head>HEAD</h4><p>获取报文首部，和 GET 一样，只是不返回报文主体部分</p><h4 id=delete>DELETE</h4><p>删除文件，和 PUT 相反，同样的原因不推荐使用</p><h4 id=options>OPTIONS</h4><p>查询资源支持什么方法</p><ul><li>INVITE</li><li>ACK</li><li>CANCEL</li><li>&mldr;</li></ul><h4 id=trace>TRACE</h4><p>服务端把接收到的请求报文再还给客户端，这样可以检查请求有没有/怎么样被加工篡改的</p><h4 id=connect>CONNECT</h4><h3 id=http-报文>HTTP 报文</h3><p>是多行数据构成的字符串文本</p><ul><li>报文 message</li><li>实体 entity</li></ul><h4 id=请求报文>请求报文</h4><h4 id=响应报文>响应报文</h4><h4 id=多部分对象集合-multipart>多部分对象集合 Multipart</h4><p>包含图片、文本、视频等多个不同类型的数据</p><p>multipart/form-data：上传 web 表单文件
multipart/byteranges：范围请求，允许服务端只发送 HTTP 消息的一部分到客户端；传输大媒体文件、断点续传时很有用</p><h3 id=断点续传获取部分内容的范围请求-range-request>断点续传（获取部分内容的范围请求 Range Request）</h3><ul><li>用首部字段 Range 指定资源的 byte 范围</li><li>范围请求的对应状态码为 206，如果服务端无法响应范围请求，会返回 200 和完整的实体内容</li></ul><p>例如：有一份 10000 字节的资源</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>GET</span> <span style=color:#f92672>/</span><span style=color:#a6e22e>tip</span>.<span style=color:#a6e22e>jpg</span> <span style=color:#a6e22e>HTTP</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1.1</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>Host</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>www</span>.<span style=color:#a6e22e>usagidesign</span>.<span style=color:#a6e22e>jp</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 返回5001-10000的部分
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Range</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>bytes</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5001</span><span style=color:#f92672>-</span><span style=color:#ae81ff>10000</span>
</span></span><span style=display:flex><span><span style=color:#75715e>// 返回5001之后的全部
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>Range</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>bytes</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>5001</span><span style=color:#f92672>-</span>
</span></span></code></pre></div><h3 id=内容协商-content-negotiationi8n>内容协商 content negotiation==i8n</h3><p>根据浏览器的默认语言（en），返回一个 uri 的 en 页面</p><p>依据是请求报文中的一些首部字段：</p><ul><li>Accept</li><li>Accept-Charset</li><li>Accept-Encoding</li><li>Accept-Language</li><li>Content-Language</li></ul><p>内容协商可以由服务端或客户端完成</p><h3 id=http-状态码>HTTP 状态码</h3><p>1-信息类
2-成功
3-重定向
4-客户端错误
5-服务端错误</p><h3 id=web-服务器>Web 服务器</h3><p>静态 web 服务器 Nginx</p><h3 id=数据转发>数据转发</h3><ul><li>代理<ul><li>缓存代理 CDN</li></ul></li><li>网关：网关是一个概念，是协议转换器（把 HTTP 转换为其他协议）</li><li>隧道</li></ul><h2 id=https>HTTPS</h2><p>http 的缺点：</p><ul><li>明文传输</li><li>不验证通信方的身份</li><li>无法保证完整性（中间人攻击）</li></ul><h2 id=tcp>TCP</h2><p>提供字节流服务（分割数据包）</p><h3 id=three-way-handshaking>three-way handshaking</h3><p>TCP 的标志 flag：SYN、ACK</p><ul><li>SYN 是发送端生成的（请求同步）</li><li>ACK 是接收端生成的（确认同步）</li></ul><p>第一次握手：发送端发送请求（syn=j）
第二次握手：接收端返回 SYN、ACK 标志，告诉对方发送功能正常，自己的接收功能正常
第三次握手：发送端告诉接收端，你的收发功能都正常（响应能力），可以开始通信了</p><ul><li>SYN blood 攻击：接到第 2 次握手后不回应第 3 次握手，服务器会发送 5 次请求然后丢弃请求。解决方法：cookie 记录恶意 ip、缩短服务器的等待时间</li></ul><p>为什么不 2 次握手：如果是 2 次握手，客户端发送一次请求后网络中断，一段时间后这个废弃的请求到达服务器，服务器就会正常响应，建立一个无效的链接，增加了网络开销</p><h2 id=dns>DNS</h2><p>应用层，把域名解析到 IP（联想：ARP）</p><h2 id=uriurl>URI/URL</h2><p>URL 是 URI 的子集，url 一定是 uri，比如网址画 url 就是 uri，同时邮件地址、电话号码也是 uri</p><h2 id=用户身份认证>用户身份认证</h2><p>认证方式：</p><ul><li>BASIC（401）</li><li>DIGEST</li><li>SSL 客户端</li><li>FormBase</li></ul></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/http>HTTP</a></li><li><a href=/tags/tech>tech</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/falasool/ rel=me title=GitHub><i data-feather=github></i></a><a class=soc href=https://gitlab.com/athul/ rel=me title=GitLab><i data-feather=gitlab></i></a></div><div class=footer-info>2024 © Falaool<br>Built with <a href=https://gohugo.io>Hugo</a> & Theme <a href=https://github.com/athul/archie>Archie</a> design by Athul</div></footer><script>feather.replace()</script></div></body></html>
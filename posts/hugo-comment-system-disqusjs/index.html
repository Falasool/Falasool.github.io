<!doctype html><html><head lang=en><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Hugo | 给博客添加评论系统 - Falasool</title><link rel=icon type=image/png href=static/img/favicon.png><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="尝试了 Twikoo、Disqus、Cataus"><meta property="og:image" content><meta property="og:title" content="Hugo | 给博客添加评论系统"><meta property="og:description" content="尝试了 Twikoo、Disqus、Cataus"><meta property="og:type" content="article"><meta property="og:url" content="https://falasool.github.io/posts/hugo-comment-system-disqusjs/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-14T19:12:42+08:00"><meta property="article:modified_time" content="2022-10-14T19:12:42+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hugo | 给博客添加评论系统"><meta name=twitter:description content="尝试了 Twikoo、Disqus、Cataus"><script src=https://falasool.github.io/js/feather.min.js></script>
<link href=https://falasool.github.io/css/fonts.4bacf4386d3f58fdc378d205a903311c80158bf414d25698589b658e0273156d.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://falasool.github.io/css/main.d073be18e0c3a69a388b4ed9b568f131056122bb167cdfdc73a313919794a3e7.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://falasool.github.io/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css media="(prefers-color-scheme: dark)"></head><body><div class=content><header><div class=main><a href=https://falasool.github.io/>Falasool</a></div><nav><a href=/friends/></a>
<a href=/about>About</a>
<a href=/friends>Friends</a>
<a href=/tags>Tags</a></nav></header><main><article><div class=title><h1 class=title>Hugo | 给博客添加评论系统</h1><div class=meta>Posted on Oct 14, 2022</div></div><section class=body><p>Update：用过 Cataus、Disqus，Cataus 和同名主题配合起来很可爱，用了一段时间 Disqus 后对它的 UI 不太满意，再加上强制登录比较恼人，就换成象友推荐的 Twikoo 试试</p><h2 id=twikoo>Twikoo</h2><h3 id=设置数据库-mongodb>设置数据库 MongoDB</h3><p>按照 <a href=https://twikoo.js.org/quick-start.html#%E5%91%BD%E4%BB%A4%E8%A1%8C%E9%83%A8%E7%BD%B2>官方文档</a> ，我用的 Vercel 部署</p><p>创建数据库，选 Free 方案，区域选择 <code>AWS / N. Virginia (us-east-1)</code>，设置并保存好用户名和密码</p><p>在 <code>Where would you like to connect from?</code> 这一步填 0.0.0.0，然后点 <code>Add Entry</code>，最后确认创建数据库</p><p>进入数据库，connect - Drivers - Node.js，把实例的用户名和密码改成自己的，例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>mongodb+srv://twikoo:fhahflanclal3o2u0@cluster0.tke1htc.mongodb.net/?retryWrites=true&amp;w=majority
</span></span></code></pre></div><h3 id=vercel-部署>Vercel 部署</h3><p>按照文档的一键部署，等待&mldr;</p><p>在控制台 - settings - Environment Variables，添加环境变量 <code>MONGODB_URI</code>，值为之前的数据库连接字符串</p><p>进入 Deployments , 然后在任意一项后面点击更多（三个点） , 然后点击 Redeploy , 最后点击下面的 Redeploy</p><p>访问 Vercel 分配的域名，如果环境配置正确，可以看到 “Twikoo 云函数运行正常” 的提示</p><p>因为 vercel.app 域名已经被中国政府屏蔽，大陆用户无法评论。不过没关系，在 twikoo-api > settings > domains 添加自定义域名可解决</p><h3 id=配置到博客>配置到博客</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>comments</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>twikoo</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>twikoo</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>envId</span>: <span style=color:#ae81ff>&lt;你的域名或vercel分配的域名&gt;</span>
</span></span></code></pre></div><p>部署成功后点右下角 ↘️ 的齿轮 ⚙️ 图标，设置管理密码</p><h3 id=更新>更新</h3><p>管理页面提示：Client version: 1.5.11， Server version: 1.6.16， 请参考 <a href=https://twikoo.js.org/quick-start.html#%E7%89%88%E6%9C%AC%E6%9B%B4%E6%96%B0>版本更新</a> 进行升级</p><p>在 twikoo.html 里把引入的 js 文件版本修改到 1.6.16</p><h3 id=进阶>进阶</h3><ul><li>多个页面共用评论区</li></ul><blockquote><p>参考 <a href=https://www.imaegoo.com/2021/twikoo-path/>Twikoo 多个页面共用一个评论区</a> 实现 About && Friends 页面共用评论区</p></blockquote><p>设置主题的 Twikoo path 配置为</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># config.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>twikoo</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>path</span>: <span style=color:#ae81ff>window.TWIKOO_MAGIC_PATH||window.location.pathname</span>
</span></span></code></pre></div><p>在两个页面的 <code>.md</code> 正文部分添加 <code>&lt;script>window.TWIKOO_MAGIC_PATH="xxx"&lt;/script></code></p><p>经测试生效 🎉</p><h2 id=disqus>Disqus</h2><p>选择 Disqus 是因为 Hugo 内置了它的模板，同时它对迁移的支持较好，本身功能非常齐全，比较遗憾的是从 2015 年开始被墙了</p><p>参考 <a href=https://gohugo.io/content-management/comments/>官方文档</a></p><h3 id=基础设置>基础设置</h3><p>在 <a href=https://disqus.com/>Disqus</a> 注册并登录账号，添加站点（选择 I want to install Disqus on my site）</p><p>输入你想要的 Website Name，用作插入 config 文件的名字，后期可以在 Disqus -> Setting -> General 下查看和修改</p><p>在 Configure Disqus for Your Site 页面输入 Website URL，要输入完整的地址，比如如果像我一样使用的是 GitHub Pages ，就要加上 <code>https://</code> 的协议名；</p><p>选择 Category，点击 Create Site 完成注册</p><p>选择方案，我选 free</p><p>编辑博客的配置文件 config.yaml，添加 disqusShortname 设置</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span># 在第 23 行左右
</span></span><span style=display:flex><span>disqusShortname: YOURSITENAME
</span></span></code></pre></div><h3 id=可选项>可选项</h3><h4 id=添加可信域>添加可信域</h4><p>Disqus 的站点名称是公开的，如果要防止被别人滥用，可以进行域名绑定，只允许信任的域名使用你的评论</p><p>在 Disqus -> Site -> Advanced 添加 Trusted Domains</p><h4 id=特定博文开启关闭评论>特定博文开启/关闭评论</h4><p><a href=https://lvv.me/posts/2019/12/10_hugo_disqus/>https://lvv.me/posts/2019/12/10_hugo_disqus/</a></p><h2 id=相关参考>相关参考</h2><p>感谢前人的耕耘和分享，希望本文也能给你带来一些帮助 ❤️</p><p><a href=https://thirdshire.com/post/twikoo-tutorial/>在静态博客里添加 Twikoo 评论系统，并配置邮箱和 TG 通知</a></p><p><a href=https://blog.fooleap.org/use-disqus-correctly.html>科学使用 Disqus</a></p><p><a href=https://juejin.cn/post/6844903905910849550>Disqus 评论框改造工程-实现 Disqus 代理的 Serverless 服务</a></p><p><a href=https://blog.skk.moe/post/disqusjs/>DisqusJS - 一个超轻量级的 DISQUS「评论基础模式」的实现</a></p><p><a href=https://lvv.me/posts/2019/12/10_hugo_disqus/>给 Hugo 开启 Disqus 评论系统</a></p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/hugo>Hugo</a></li><li><a href=/tags/tech>tech</a></li><li><a href=/tags/comment-system>comment system</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/falasool/ rel=me title=GitHub><i data-feather=github></i></a></div><div class=footer-info>2024 © Falaool | Built with <a href=https://gohugo.io>Hugo</a> & Theme <a href=https://github.com/athul/archie>Archie</a> design by Athul</div></footer><script>feather.replace()</script></div></body></html>